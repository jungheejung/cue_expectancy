# 49_iv-cue-stim_dv-firglasserSPM_ttl1 {#ch49_timeseries}
---
title: "49_iv-6cond_dv-firglasserSPM_ttl1"
output: html_document
date: "2023-08-14"
---



## load tsv
## concatenate 
## per time column, calculate mean and variance
## plot



## parameters {TODO: ignore}

```r
# parameters
main_dir <- dirname(dirname(getwd()))
datadir <- file.path(main_dir, 'analysis/fmri/nilearn/glm/fir')
analysis_folder  = paste0("model49_iv-6cond_dv-firglasserSPM_ttl1")
analysis_dir <-
  file.path(main_dir,
            "analysis",
            "mixedeffect",
            analysis_folder,
            as.character(Sys.Date())) # nolint
dir.create(analysis_dir,
           showWarnings = FALSE,
           recursive = TRUE)
savedir <- analysis_dir
```


```r
plot_timeseries_onefactor <-  function(df, iv1,  mean, error, xlab, ylab, ggtitle, color) {
    
n_points <- 100  # Number of points for interpolation
    g <- ggplot(
      data = df,
      aes(
        x = .data[[iv1]],
        y = .data[[mean]],
        group = 1,
        color = color
      ),
      cex.lab = 1.5,
      cex.axis = 2,
      cex.main = 1.5,
      cex.sub = 1.5
    ) +

      geom_errorbar(aes(
        ymin = (.data[[mean]] - .data[[error]]),
        ymax = (.data[[mean]] + .data[[error]]),
        color = color
      ), width = .1, alpha=0.8) +

      geom_line() +
      geom_point(color=color) +
      ggtitle(ggtitle) +
      xlab(xlab) +
      ylab(ylab) +

      theme_classic() +
      
      theme(aspect.ratio = .6) +
      expand_limits(x = 3.25) +

      scale_color_manual("",
                         values =  color) +
            # scale_fill_manual("",
                         # values =  color) +
      theme(
        legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.margin = margin(6, 6, 6, 6)
      ) +
      theme(legend.key = element_rect(fill = "white", colour = "white")) +
      theme_bw()
    
    return(g)
  }
```

## epoch: stim, high stim vs low stim

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high stim vs low stim
# ------------------------------------------------------------------------------
datadir = "/Volumes/spacetop_projects_cue/analysis/fmri/spm/fir/ttl1par"
taskname = "pain"
exclude <- "sub-0001"
filename <- paste0("sub-*_runtype-", taskname, "*roi-rINS_tr-42.csv")
  common_path <- Sys.glob(file.path(datadir, "sub-*",  filename
  ))
  filter_path <- common_path[!str_detect(common_path, pattern = exclude)]

df <- do.call("rbind.fill", lapply(filter_path, FUN = function(files) {
    read.table(files, header = TRUE, sep = ",")
    }))
```



```r
# filtered_df <- subset(df, condition != "rating")
filtered_df <- df[!(df$condition == "rating" | df$condition == "cue"), ]

parsed_df <- filtered_df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)

TR_length <- 42
# --------------------- subset regions based on ROI ----------------------------
df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "stim_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("stim_ordered", "tr_ordered"),
  idvar = "sub"
)
```

```
## 
## Attaching package: 'raincloudplots'
```

```
## The following object is masked _by_ '.GlobalEnv':
## 
##     GeomFlatViolin
```

```r
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "stim_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p1 = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High stim vs. Low stim", ggtitle="time_series", color=c("#5f0f40","#ae2012", "#fcbf49"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p1 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-4-1.png" width="672" />







### PCA subjectwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("tr_ordered", "stim_ordered"), 
                       names_from = "sub", 
                       values_from = "mean_per_sub")

df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("sub", "stim_ordered"), 
                       names_from = "tr_ordered", 
                       values_from = "mean_per_sub")
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
high.pca_result <- prcomp(meanhighdf)
high.pca_scores <- as.data.frame(high.pca_result$x)
# Access the proportion of variance explained by each principal component
high.variance_explained <- high.pca_result$sdev^2 / sum(high.pca_result$sdev^2)
plot(high.variance_explained)
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-5-1.png" width="672" />

```r
# Access the standard deviations of each principal component
high.stdev <- high.pca_result$sdev

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
low.pca <- prcomp(meanlowdf)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
```

```
## 
## Attaching package: 'plotly'
```

```
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
```

```
## The following objects are masked from 'package:plyr':
## 
##     arrange, mutate, rename, summarise
```

```
## The following object is masked from 'package:reshape':
## 
##     rename
```

```
## The following object is masked from 'package:stats':
## 
##     filter
```

```
## The following object is masked from 'package:graphics':
## 
##     layout
```

```r
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1388a3b9c0509317d814" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1388a3b9c0509317d814">{"x":{"visdat":{"a5239176525":["function () ","plotlyVisDat"]},"cur_data":"a5239176525","attrs":{"a5239176525":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-71.580267732703376,-6.7825983960516405,-7.278761766323969,60.759680937056721,-13.460214488073154,55.547561723381378,11.331824205769514,9.6179212429438152,22.271991967587837,-17.261415759681292,-62.199737091749043,-0.76582160960197843,-42.054795136924909,-52.897672803946058,-31.710597409021176,-18.469323984555754,-48.209691902330619,-66.370997656812833,15.940549546615145,-21.000387293733127,109.41280855735747,-4.4498153755464953,-32.412763784350659,0.6102491966990069,38.657464903894343,14.278345156992962,90.784633834571991,138.93739490761953,141.40859954535313,1.7884609709735289,21.58774738840453,-0.8006882597790167,24.613258282340674,99.879772749394832,-55.974411201552606,-5.5624930045883536,6.5800153131718044,-53.864121604181058,-22.954067272959655,-23.220614991341993,-27.795410532325921,-11.773251846958068,20.10837785647653,-12.933688964300156,6.2507875471832142,39.973359264527176,-47.237925710117672,66.744917322917715,-27.823824942894831,-105.92927992763902,88.121548040866017,-71.813542346004212,-53.680842159398722,97.752970283551861,-31.701638611420893,72.006950450972056,4.1349718269187159,-25.782852011639712,-11.977179474788603,-20.069887130540771,-15.486872069483534,23.466994581332482,-122.25551494396299,19.311899532225866,-20.112895724826402,-125.26356636341824,44.909953383102746,-35.526458479260825,-154.39672492445081,88.916131270858045,9.2272844149520257,-7.7613526256041325,111.05731629905102,-2.5103449091619416,-41.81521753983764,-75.059180660849506,0.15223240532155741,-79.469530272439982,33.594414530432942,-10.33656198654746,47.822888600150833,-17.231949158993945,-28.283117672299028,-4.8558456617557608,38.388798668062762,-28.066063036342211,10.493936350607012,-12.627728878894464,76.649252492896935,-69.947438615928306,28.714032824785804,-6.598791578521837,50.305098649636967,35.025477097383089,-123.4886516158337,19.580571784666876,101.36404994697554,0.42715805037136956,17.63479699496899,-3.2639702506555577,-27.370565110526066,87.416777467941131,17.676788852605963,-57.607656801722435,-21.628507012498325,96.159545412130925,-48.359888271600546,29.727413715251103],"y":[22.787221864916713,-20.815602929558633,49.237753824024992,45.618340732998902,-8.9359211664408953,10.57748702841797,-24.524279185116082,-18.639082866756965,56.37205968135865,-19.296511819257187,13.075486983644543,-9.6296142289266591,1.4757994587666823,29.251852059183722,-47.60719471789411,9.6764253043923798,11.482171847590644,20.14986634480104,-4.1808921409828708,-39.253176050567276,37.250933364062199,-43.325981313524686,-22.545923745318813,-23.406848588898082,36.708851753023097,50.986241877615555,-9.6760592302874464,-42.837695080198642,51.364206054805521,-1.4740111052855409,22.794309214147727,13.864681017802996,32.03915134233786,-1.0961216968609298,15.427312089562717,22.883544171114835,-24.466700209618132,22.853477430959266,63.089460066007923,-59.677502932575827,-3.5063724559821119,-21.067634052279406,-16.38448409343097,-43.443866236878819,-19.885894999400648,-18.554137911421769,-46.432474225755556,38.914064869630302,-22.593688201820626,106.91323092383786,4.1951235341121684,-0.01339189181369032,-52.207326128802499,79.173685074789361,-3.2803734092088135,-3.9290023752096892,69.862708059739646,-23.618064337222361,-14.98553464762219,21.283382230971529,-17.603684283795612,-6.700610940285574,-32.249765569482378,-10.261231044631137,-9.0108729024419496,7.7229173043186972,8.2273055409105993,-57.419409571363879,43.492041738282829,-7.8009692274782516,-2.1298664310597819,-33.320241251836975,-14.848403499358595,-52.566984296599706,43.559108908891886,-23.440417148397611,-14.464662123339318,27.033550270476312,56.841202753535761,-11.709703635872211,-39.444329248292902,-54.073910902683956,23.626954595354722,-0.26997950345817101,-0.083076591467188377,31.99038047401417,-28.039971998212557,9.6520870077497403,59.976953222826296,-19.151238465058761,86.009043947249836,-66.028489135664429,-5.0669082119200803,-36.316027122341772,98.713344778831456,-6.5044552232816217,22.776427478477192,-4.2367792616255215,9.2332481246245912,-53.058182289765618,-59.95769655018713,-7.5890458673121346,-2.3428052134005006,3.7105268744953035,-42.950515079423432,-37.091262586382435,8.6449828584261414,-33.49604493174359],"z":[-1.0836397216436577,8.806991154475547,-5.971556433004479,27.107035909872774,-0.03501562768354681,-3.5690935743420584,7.0970726814747263,-5.7212551486954961,-16.058235882856415,-3.3295772393719005,-7.9740192704050719,6.2166602720391584,61.895387400450176,-17.002849552216968,7.7954639031442188,-2.2202307213626868,-67.331252732903835,-0.58210796975352919,-0.054492612566801032,3.6449464990488138,-2.2561718211953048,-0.65431355341819708,7.5174477755290479,7.6464029991289637,17.706793856999234,-18.507859460510847,10.932886734302746,-12.730734216719304,25.292387961619898,13.571676863882248,24.909005328338992,-22.061154527414022,-10.245480839767865,1.0322412243673127,-47.901407154428902,27.737050973010714,-6.6524246617188902,53.189758093215758,16.957601479872761,26.143951642673972,-13.438775867302228,-17.748039468710839,-10.283145895343385,-16.210996440281022,-11.246307358700161,16.991047475601761,14.725676364797541,42.875068856258792,-6.2450680943204135,-41.874553365995105,-36.043765995176457,-27.440674374506393,2.0259657143399461,-47.051940416844708,17.022748436471002,18.811301841729652,-10.747819138185317,-5.9264136149424296,0.99170175683888384,-2.9529196371176027,-20.250592956871802,49.050090281803271,2.1866779908618246,-13.988105854460388,3.2536756675795817,25.018723069026692,-25.937988130831791,58.402897349094616,-2.1823406123359819,-14.031516431303668,-5.8221923105683766,-11.9657001087757,3.3558835499961988,24.061550351735107,15.968591161017834,7.2711977848494662,40.998323616188124,-16.482036520439401,-7.3437121733112747,0.75992487730925451,-21.624528184602944,0.015272746928440223,0.48074433385743187,-2.7812093795009316,-16.906883112755299,-16.692708037367126,-11.309347077144098,0.21898833530606732,32.730052310360335,-64.052608427977049,14.611705087554583,-3.1957487494171217,11.130688625190675,-4.7010159937792588,73.252547707824846,-6.4806678137450424,-11.159223642567353,11.286400899053776,28.896291443255574,16.443151869608553,1.5525572780817232,0.58244678865417709,-11.454078140952809,-45.078137793908709,-5.5348915676639194,-20.946314542632852,-27.569136614617825,-3.5286797576859974],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-28.649551493523287,-26.105289830727749,88.462191486467447,-23.86680557088366,-30.877439444121524,40.532323758949438,18.578900666102705,9.4857679828279462,23.401630751411282,-40.495208109159599,-24.836339228367521,19.021386676918397,-127.89184855140918,-27.174371635452225,-59.466052673177316,138.997251444661,-27.234811978606988,-40.725011125741737,-14.549521901922844,-27.537074553783093,90.318737030032452,-48.805183965457111,-37.087555767558356,-16.139498432146194,74.20829020084841,-6.7926408394667614,-17.80335954959212,12.562932911630259,100.32312839098081,-3.3093505436046211,29.486320887837319,-62.181701380586006,27.486997407672717,66.044922160114751,0.53341743898799732,-14.047722265174038,-0.2872008034147821,-54.541576321925781,-39.755782467776939,82.173984699587905,-29.217009398213197,-29.533217447338053,2.7220109752950212,1.4262660430999261,-3.3155392340226939,-29.680782508589825,-41.949678735314002,35.421188210468486,-22.020348211510509,71.290725368342578,-4.9764548753894555,-23.859272164877108,-45.563930062430678,63.867797441675179,-24.343707070302521,47.3035266559748,47.909577288842094,-34.544494240354474,-16.675313156270033,-9.7314273859655955,20.971609685912856,-0.53632515100844502,-108.86568611632862,28.884871390368463,-71.684961342709499,-0.99754273485829525,6.1716824559756311,9.7588594010514651,3.1728150821251462,16.99378020732712,-25.044030494015875,12.370507416769536,179.30386299308569,45.957169908078946,13.757592609114486,-84.916301067222548,-5.6473310119445888,-39.237374811457265,6.9958221373216158,-8.5559159113082828,-7.3282577988834792,-48.160367546727329,-12.203932304773952,-29.959890955751025,53.765958559191027,22.711151255098873,-20.133646398392283,4.8045179924741435,92.005138673477774,-99.897421120486229,37.321761881865086,-25.865853497370768,45.66141121302158,-112.0643516617605,-62.752104780725368,85.70917084527656,72.019721929167702,-18.884280641648829,81.38940723280956,-11.219531645061149,-38.597760744844187,49.431964442872427,15.193734779834831,-51.35564388575591,-31.800428702977172,80.455178374786485,-23.625980327091355,-21.459972768475275],"y":[11.420125943843422,8.2560795032728613,13.718638332533466,4.4063344698996696,20.041489135264026,1.97859070073513,-4.8433310740087903,-13.99241846135636,63.240224465511304,6.5252984294859946,16.721869627102638,-1.2937931685289776,-24.472309734265007,42.751429386418145,-13.357417979829782,-55.462468296849003,1.0072018784276207,28.134346330085169,5.3083708187196317,-24.124859904317717,-5.2063460560789814,-18.247254606594591,1.9172322624259859,0.0058842527096695059,3.8433879279451335,4.0001154160085024,-9.8765164247878783,-45.553027790695303,52.478916918288768,1.2347832623084809,-21.481047768033317,-4.1991487666025664,22.182684268924586,21.551797590195349,49.121827470536672,74.449472994208378,-9.7678157107099022,-0.2267593359357262,-15.854989651698563,-6.9186976571367351,9.0658276094417136,-3.9774951430422263,-12.621877042640842,-15.038422421740098,-18.363914628324046,-8.6469637838490865,-9.6784440703556402,24.127505962169597,-1.2076045793614441,40.077465804973009,-5.0382999364787313,-8.1225369969949863,1.4748393217393574,12.022457869896751,25.321254508236557,-24.22791220050571,-11.333961122636783,-16.815450358867441,1.4286384374810832,21.306469308023779,5.480355665540694,-9.4667243664949794,10.264563391969102,34.802278804974591,27.950924358131747,-13.472149065365457,-25.249776757818562,-0.062424917969601153,15.513198638689474,-24.00098374810614,4.2711779895314468,-9.6166365849436879,-16.047339407179916,-17.232367470599229,43.085500197728557,33.226300518075263,15.450068762775016,55.144624758331396,31.292285924335292,13.587838871562955,-13.426622571016695,-20.193444134998281,9.6945858366095141,-5.5537648099530417,-21.976391992702869,22.935377385687183,-46.880738470451895,15.163210065990432,3.2261441875364598,-2.7881267552166067,62.85392416564995,-32.692105926654861,-16.257534583573147,-24.353370982081842,-87.861521022029592,-22.681524032953753,-12.211811157224204,10.566456907586808,-25.356328998341681,-46.248913624394184,-20.554194509447136,29.541823315606443,-0.58163289374870486,-0.95110273101412535,-22.354662235028837,-65.47715922514638,10.398510857019916,-30.069273163463624],"z":[-19.264376755632355,8.6385623047174303,-23.478784595665012,39.685676352335612,-8.7089192016854486,11.04991634247447,11.557840752673945,-11.950940921017017,-12.819636229833245,3.226314088037515,-18.155917316107068,12.534418415645417,19.34146417660731,-1.1039570884946117,-0.91152184036892192,-27.598795823760337,-19.151548872028087,-33.279897898716662,0.59527707467334345,-9.3844379200210764,-6.3965169467055905,9.482497942317142,4.3393695791943498,5.8644191728506669,11.941142583322904,2.3787849071362035,18.699293452162802,-1.0267129518798364,30.885776543323296,5.1407542892595357,19.514862249891348,1.1174221104360538,3.2193379013645127,26.192577238778892,-23.014040381712036,27.798892630755933,-10.501488847063513,-30.164074416089466,32.922518435392234,15.618331532628458,-3.6881338454794852,-0.15600055213200126,-3.5605854124313305,3.4044167588376211,-4.2838523994806401,42.408280845637492,4.5044447614147645,46.032620834518411,-12.974862124518854,-19.130417043045632,-12.512737574565467,-24.646779454731078,-16.255195111373986,-25.849247635529107,-7.6629006538377107,20.150024981884719,-6.8765603133398923,9.4998910921479442,6.3967984860537657,19.838856517289841,-22.963593280503254,20.891045763602254,-35.12235925888006,-50.683467426525894,5.6533458703663149,14.280591824671788,5.4834487839180497,1.2991891767758637,9.6028607330606679,5.6287033195511649,-20.196119230374787,-6.6901084558313393,-30.476117576774136,-38.560538594544951,-1.342833582909299,5.5146635833518403,9.8967942394771562,-30.740349910469675,11.50398666603183,-11.819582880604527,4.8691015782682889,-5.3315404489067335,6.4175036157722474,7.1839020411561192,7.3020715718135936,5.8384974003704935,-1.0668535030237987,-15.340519659642004,26.436069970827631,-23.438783522889974,61.161733101994372,-14.267903633194132,13.208442431632649,27.776624975556462,11.572726442931176,-28.487369813752288,14.75689703012344,-10.891265173575158,-6.2318065173584314,-5.6055957953781181,9.4870528626525417,4.3944129310755429,11.889516188050315,-9.4455683679406075,-2.3368997463262984,12.087933591382633,-20.727645393145362,-1.8422381483819166],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints
```

### PCA groupwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide.group <- pivot_wider(subjectwise,
                       id_cols = c("tr_ordered", "stim_ordered"),
                       names_from = "sub",
                       values_from = "mean_per_sub")
# ------
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# datapoints <- df_ordered$mean_per_sub_norm_mean
# data_df <- data.frame(Dim1 = datapoints, Dim2 = datapoints, Dim3 = datapoints)
# pca <- prcomp(data_df)
# pca_scores <- as.data.frame(pca$x)
# plot_ly(pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# -------
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
high.pca <- prcomp(meanhighdf)
high.pca_scores <- as.data.frame(high.pca$x)

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
low.pca <- prcomp(meanlowdf)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a122869a5bab816318e5" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-a122869a5bab816318e5">{"x":{"visdat":{"a5233a10bdc6":["function () ","plotlyVisDat"]},"cur_data":"a5233a10bdc6","attrs":{"a5233a10bdc6":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-71.580267732703376,-6.7825983960516405,-7.278761766323969,60.759680937056721,-13.460214488073154,55.547561723381378,11.331824205769514,9.6179212429438152,22.271991967587837,-17.261415759681292,-62.199737091749043,-0.76582160960197843,-42.054795136924909,-52.897672803946058,-31.710597409021176,-18.469323984555754,-48.209691902330619,-66.370997656812833,15.940549546615145,-21.000387293733127,109.41280855735747,-4.4498153755464953,-32.412763784350659,0.6102491966990069,38.657464903894343,14.278345156992962,90.784633834571991,138.93739490761953,141.40859954535313,1.7884609709735289,21.58774738840453,-0.8006882597790167,24.613258282340674,99.879772749394832,-55.974411201552606,-5.5624930045883536,6.5800153131718044,-53.864121604181058,-22.954067272959655,-23.220614991341993,-27.795410532325921,-11.773251846958068,20.10837785647653,-12.933688964300156,6.2507875471832142,39.973359264527176,-47.237925710117672,66.744917322917715,-27.823824942894831,-105.92927992763902,88.121548040866017,-71.813542346004212,-53.680842159398722,97.752970283551861,-31.701638611420893,72.006950450972056,4.1349718269187159,-25.782852011639712,-11.977179474788603,-20.069887130540771,-15.486872069483534,23.466994581332482,-122.25551494396299,19.311899532225866,-20.112895724826402,-125.26356636341824,44.909953383102746,-35.526458479260825,-154.39672492445081,88.916131270858045,9.2272844149520257,-7.7613526256041325,111.05731629905102,-2.5103449091619416,-41.81521753983764,-75.059180660849506,0.15223240532155741,-79.469530272439982,33.594414530432942,-10.33656198654746,47.822888600150833,-17.231949158993945,-28.283117672299028,-4.8558456617557608,38.388798668062762,-28.066063036342211,10.493936350607012,-12.627728878894464,76.649252492896935,-69.947438615928306,28.714032824785804,-6.598791578521837,50.305098649636967,35.025477097383089,-123.4886516158337,19.580571784666876,101.36404994697554,0.42715805037136956,17.63479699496899,-3.2639702506555577,-27.370565110526066,87.416777467941131,17.676788852605963,-57.607656801722435,-21.628507012498325,96.159545412130925,-48.359888271600546,29.727413715251103],"y":[22.787221864916713,-20.815602929558633,49.237753824024992,45.618340732998902,-8.9359211664408953,10.57748702841797,-24.524279185116082,-18.639082866756965,56.37205968135865,-19.296511819257187,13.075486983644543,-9.6296142289266591,1.4757994587666823,29.251852059183722,-47.60719471789411,9.6764253043923798,11.482171847590644,20.14986634480104,-4.1808921409828708,-39.253176050567276,37.250933364062199,-43.325981313524686,-22.545923745318813,-23.406848588898082,36.708851753023097,50.986241877615555,-9.6760592302874464,-42.837695080198642,51.364206054805521,-1.4740111052855409,22.794309214147727,13.864681017802996,32.03915134233786,-1.0961216968609298,15.427312089562717,22.883544171114835,-24.466700209618132,22.853477430959266,63.089460066007923,-59.677502932575827,-3.5063724559821119,-21.067634052279406,-16.38448409343097,-43.443866236878819,-19.885894999400648,-18.554137911421769,-46.432474225755556,38.914064869630302,-22.593688201820626,106.91323092383786,4.1951235341121684,-0.01339189181369032,-52.207326128802499,79.173685074789361,-3.2803734092088135,-3.9290023752096892,69.862708059739646,-23.618064337222361,-14.98553464762219,21.283382230971529,-17.603684283795612,-6.700610940285574,-32.249765569482378,-10.261231044631137,-9.0108729024419496,7.7229173043186972,8.2273055409105993,-57.419409571363879,43.492041738282829,-7.8009692274782516,-2.1298664310597819,-33.320241251836975,-14.848403499358595,-52.566984296599706,43.559108908891886,-23.440417148397611,-14.464662123339318,27.033550270476312,56.841202753535761,-11.709703635872211,-39.444329248292902,-54.073910902683956,23.626954595354722,-0.26997950345817101,-0.083076591467188377,31.99038047401417,-28.039971998212557,9.6520870077497403,59.976953222826296,-19.151238465058761,86.009043947249836,-66.028489135664429,-5.0669082119200803,-36.316027122341772,98.713344778831456,-6.5044552232816217,22.776427478477192,-4.2367792616255215,9.2332481246245912,-53.058182289765618,-59.95769655018713,-7.5890458673121346,-2.3428052134005006,3.7105268744953035,-42.950515079423432,-37.091262586382435,8.6449828584261414,-33.49604493174359],"z":[-1.0836397216436577,8.806991154475547,-5.971556433004479,27.107035909872774,-0.03501562768354681,-3.5690935743420584,7.0970726814747263,-5.7212551486954961,-16.058235882856415,-3.3295772393719005,-7.9740192704050719,6.2166602720391584,61.895387400450176,-17.002849552216968,7.7954639031442188,-2.2202307213626868,-67.331252732903835,-0.58210796975352919,-0.054492612566801032,3.6449464990488138,-2.2561718211953048,-0.65431355341819708,7.5174477755290479,7.6464029991289637,17.706793856999234,-18.507859460510847,10.932886734302746,-12.730734216719304,25.292387961619898,13.571676863882248,24.909005328338992,-22.061154527414022,-10.245480839767865,1.0322412243673127,-47.901407154428902,27.737050973010714,-6.6524246617188902,53.189758093215758,16.957601479872761,26.143951642673972,-13.438775867302228,-17.748039468710839,-10.283145895343385,-16.210996440281022,-11.246307358700161,16.991047475601761,14.725676364797541,42.875068856258792,-6.2450680943204135,-41.874553365995105,-36.043765995176457,-27.440674374506393,2.0259657143399461,-47.051940416844708,17.022748436471002,18.811301841729652,-10.747819138185317,-5.9264136149424296,0.99170175683888384,-2.9529196371176027,-20.250592956871802,49.050090281803271,2.1866779908618246,-13.988105854460388,3.2536756675795817,25.018723069026692,-25.937988130831791,58.402897349094616,-2.1823406123359819,-14.031516431303668,-5.8221923105683766,-11.9657001087757,3.3558835499961988,24.061550351735107,15.968591161017834,7.2711977848494662,40.998323616188124,-16.482036520439401,-7.3437121733112747,0.75992487730925451,-21.624528184602944,0.015272746928440223,0.48074433385743187,-2.7812093795009316,-16.906883112755299,-16.692708037367126,-11.309347077144098,0.21898833530606732,32.730052310360335,-64.052608427977049,14.611705087554583,-3.1957487494171217,11.130688625190675,-4.7010159937792588,73.252547707824846,-6.4806678137450424,-11.159223642567353,11.286400899053776,28.896291443255574,16.443151869608553,1.5525572780817232,0.58244678865417709,-11.454078140952809,-45.078137793908709,-5.5348915676639194,-20.946314542632852,-27.569136614617825,-3.5286797576859974],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-28.649551493523287,-26.105289830727749,88.462191486467447,-23.86680557088366,-30.877439444121524,40.532323758949438,18.578900666102705,9.4857679828279462,23.401630751411282,-40.495208109159599,-24.836339228367521,19.021386676918397,-127.89184855140918,-27.174371635452225,-59.466052673177316,138.997251444661,-27.234811978606988,-40.725011125741737,-14.549521901922844,-27.537074553783093,90.318737030032452,-48.805183965457111,-37.087555767558356,-16.139498432146194,74.20829020084841,-6.7926408394667614,-17.80335954959212,12.562932911630259,100.32312839098081,-3.3093505436046211,29.486320887837319,-62.181701380586006,27.486997407672717,66.044922160114751,0.53341743898799732,-14.047722265174038,-0.2872008034147821,-54.541576321925781,-39.755782467776939,82.173984699587905,-29.217009398213197,-29.533217447338053,2.7220109752950212,1.4262660430999261,-3.3155392340226939,-29.680782508589825,-41.949678735314002,35.421188210468486,-22.020348211510509,71.290725368342578,-4.9764548753894555,-23.859272164877108,-45.563930062430678,63.867797441675179,-24.343707070302521,47.3035266559748,47.909577288842094,-34.544494240354474,-16.675313156270033,-9.7314273859655955,20.971609685912856,-0.53632515100844502,-108.86568611632862,28.884871390368463,-71.684961342709499,-0.99754273485829525,6.1716824559756311,9.7588594010514651,3.1728150821251462,16.99378020732712,-25.044030494015875,12.370507416769536,179.30386299308569,45.957169908078946,13.757592609114486,-84.916301067222548,-5.6473310119445888,-39.237374811457265,6.9958221373216158,-8.5559159113082828,-7.3282577988834792,-48.160367546727329,-12.203932304773952,-29.959890955751025,53.765958559191027,22.711151255098873,-20.133646398392283,4.8045179924741435,92.005138673477774,-99.897421120486229,37.321761881865086,-25.865853497370768,45.66141121302158,-112.0643516617605,-62.752104780725368,85.70917084527656,72.019721929167702,-18.884280641648829,81.38940723280956,-11.219531645061149,-38.597760744844187,49.431964442872427,15.193734779834831,-51.35564388575591,-31.800428702977172,80.455178374786485,-23.625980327091355,-21.459972768475275],"y":[11.420125943843422,8.2560795032728613,13.718638332533466,4.4063344698996696,20.041489135264026,1.97859070073513,-4.8433310740087903,-13.99241846135636,63.240224465511304,6.5252984294859946,16.721869627102638,-1.2937931685289776,-24.472309734265007,42.751429386418145,-13.357417979829782,-55.462468296849003,1.0072018784276207,28.134346330085169,5.3083708187196317,-24.124859904317717,-5.2063460560789814,-18.247254606594591,1.9172322624259859,0.0058842527096695059,3.8433879279451335,4.0001154160085024,-9.8765164247878783,-45.553027790695303,52.478916918288768,1.2347832623084809,-21.481047768033317,-4.1991487666025664,22.182684268924586,21.551797590195349,49.121827470536672,74.449472994208378,-9.7678157107099022,-0.2267593359357262,-15.854989651698563,-6.9186976571367351,9.0658276094417136,-3.9774951430422263,-12.621877042640842,-15.038422421740098,-18.363914628324046,-8.6469637838490865,-9.6784440703556402,24.127505962169597,-1.2076045793614441,40.077465804973009,-5.0382999364787313,-8.1225369969949863,1.4748393217393574,12.022457869896751,25.321254508236557,-24.22791220050571,-11.333961122636783,-16.815450358867441,1.4286384374810832,21.306469308023779,5.480355665540694,-9.4667243664949794,10.264563391969102,34.802278804974591,27.950924358131747,-13.472149065365457,-25.249776757818562,-0.062424917969601153,15.513198638689474,-24.00098374810614,4.2711779895314468,-9.6166365849436879,-16.047339407179916,-17.232367470599229,43.085500197728557,33.226300518075263,15.450068762775016,55.144624758331396,31.292285924335292,13.587838871562955,-13.426622571016695,-20.193444134998281,9.6945858366095141,-5.5537648099530417,-21.976391992702869,22.935377385687183,-46.880738470451895,15.163210065990432,3.2261441875364598,-2.7881267552166067,62.85392416564995,-32.692105926654861,-16.257534583573147,-24.353370982081842,-87.861521022029592,-22.681524032953753,-12.211811157224204,10.566456907586808,-25.356328998341681,-46.248913624394184,-20.554194509447136,29.541823315606443,-0.58163289374870486,-0.95110273101412535,-22.354662235028837,-65.47715922514638,10.398510857019916,-30.069273163463624],"z":[-19.264376755632355,8.6385623047174303,-23.478784595665012,39.685676352335612,-8.7089192016854486,11.04991634247447,11.557840752673945,-11.950940921017017,-12.819636229833245,3.226314088037515,-18.155917316107068,12.534418415645417,19.34146417660731,-1.1039570884946117,-0.91152184036892192,-27.598795823760337,-19.151548872028087,-33.279897898716662,0.59527707467334345,-9.3844379200210764,-6.3965169467055905,9.482497942317142,4.3393695791943498,5.8644191728506669,11.941142583322904,2.3787849071362035,18.699293452162802,-1.0267129518798364,30.885776543323296,5.1407542892595357,19.514862249891348,1.1174221104360538,3.2193379013645127,26.192577238778892,-23.014040381712036,27.798892630755933,-10.501488847063513,-30.164074416089466,32.922518435392234,15.618331532628458,-3.6881338454794852,-0.15600055213200126,-3.5605854124313305,3.4044167588376211,-4.2838523994806401,42.408280845637492,4.5044447614147645,46.032620834518411,-12.974862124518854,-19.130417043045632,-12.512737574565467,-24.646779454731078,-16.255195111373986,-25.849247635529107,-7.6629006538377107,20.150024981884719,-6.8765603133398923,9.4998910921479442,6.3967984860537657,19.838856517289841,-22.963593280503254,20.891045763602254,-35.12235925888006,-50.683467426525894,5.6533458703663149,14.280591824671788,5.4834487839180497,1.2991891767758637,9.6028607330606679,5.6287033195511649,-20.196119230374787,-6.6901084558313393,-30.476117576774136,-38.560538594544951,-1.342833582909299,5.5146635833518403,9.8967942394771562,-30.740349910469675,11.50398666603183,-11.819582880604527,4.8691015782682889,-5.3315404489067335,6.4175036157722474,7.1839020411561192,7.3020715718135936,5.8384974003704935,-1.0668535030237987,-15.340519659642004,26.436069970827631,-23.438783522889974,61.161733101994372,-14.267903633194132,13.208442431632649,27.776624975556462,11.572726442931176,-28.487369813752288,14.75689703012344,-10.891265173575158,-6.2318065173584314,-5.6055957953781181,9.4870528626525417,4.3944129310755429,11.889516188050315,-9.4455683679406075,-2.3368997463262984,12.087933591382633,-20.727645393145362,-1.8422381483819166],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints

# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
# combined_pca <- combined_pca_scores %>%
  # mutate(group_index = group_indices(., stim_ordered))

combined_pca <- combined_pca_scores %>%
  group_by(stim_ordered) %>%
  mutate(group_index = row_number())
ggplot(combined_pca, aes(x=group_index,y=PC1, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-6-2.png" width="672" />



```r
# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-7-1.png" width="672" />

```r
# ggplot(data=groupwise, aes(x=tr_ordered, y=mean_per_sub_mean, ymin=se, ymax=se, fill=stim_ordered, linetype=stim_ordered)) + 
#  geom_line() + 
#  geom_ribbon(alpha=0.5)  
# Assuming you have a dataframe named 'data' containing the 20 mean data points and corresponding standard errors
# 'x' represents the x-values (e.g., time points)
# 'mean_y' represents the mean y-values
# 'se_y' represents the standard errors of the mean y-values

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)
# groupwise$x <- as.numeric(groupwise$x)
# 
# # Sort the dataframe by the 'x' variable (if it's not already sorted)
# data <- data[order(data$x), ]

# Create the plot
# Create the plot with custom span and smoothing method
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean)) +
  geom_line() +                                   # Plot the smooth line for the mean
  geom_ribbon(aes(ymin = mean_per_sub_mean - se, ymax = mean_per_sub_mean + se), alpha = 0.3) + # Add the ribbon for standard error
  geom_smooth(method = "loess", span = 0.1, se = FALSE) +       # Add the loess smoothing curve
  labs(x = "X-axis Label", y = "Y-axis Label", title = "Smooth Line with Standard Error Ribbon") +
  theme_minimal()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-8-1.png" width="672" />



## epoch: stim, high cue vs low cue


```r
# filtered_df <- subset(df, condition != "rating")
filtered_df <- df[!(df$condition == "rating" | df$condition == "cue"), ]

parsed_df <- filtered_df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)

TR_length <- 42
# --------------------- subset regions based on ROI ----------------------------
df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH","cueL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "cue_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("cue_ordered", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "cue_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p1 = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("red", "blue"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p1 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-9-1.png" width="672" />

## epoch: stim, rating



```r
# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
# LINEIV2 = "cue_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p2 = plot_timeseries_onefactor(groupwise_sorted, 
               LINEIV1,MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color="red")
time_points <- seq(1, 0.46 * TR_length, 0.46)
p2 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-11-1.png" width="672" />

```r
p2 + theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-11-2.png" width="672" />



## epoch: 6 cond

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high cue vs low cue
# ------------------------------------------------------------------------------
# --------------------- subset regions based on ROI ----------------------------

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH", "cueL")
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

df_long$sixcond <- factor(
        df_long$condition,
        levels = c("cueH_stimH", "cueL_stimH", 
                   "cueH_stimM", "cueL_stimM",
                   "cueH_stimL", "cueL_stimL")
) 
# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "sixcond"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("sixcond", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "sixcond"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p3H = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("High intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")" ), color=c("red","#5f0f40","gray", "gray", "gray", "gray"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3H + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-12-1.png" width="672" />

```r
p3H + theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-12-2.png" width="672" />


```r
p3M = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("Medium intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")"), color=c("#d6d6d6","#d6d6d6","#bc3908", "#f6aa1c", "gray", "gray"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3M + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-13-1.png" width="672" />

```r
p3M + theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-13-2.png" width="672" />


```r
p3L = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("Low intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")"), color=c("gray","gray","gray", "gray", "#2541b2", "#00a6fb"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3L + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-14-1.png" width="672" />

```r
p3L + theme_classic()
```

<img src="49_iv-6cond_dv-firglasserSPM_ttl1_files/figure-html/unnamed-chunk-14-2.png" width="672" />







