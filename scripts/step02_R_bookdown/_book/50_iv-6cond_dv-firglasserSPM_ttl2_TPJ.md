# [fMRI] FIR ~ task {#ch50_fir_glasserTPJ}
---
title: "51_iv-6cond_dv-firglasserSPM_ttl2_TPJ"
output: html_document
date: "2023-08-14"
---



## load tsv
## concatenate 
## per time column, calculate mean and variance
## plot



## parameters {TODO: ignore}

```r
# parameters
main_dir <- dirname(dirname(getwd()))
datadir <- file.path(main_dir, 'analysis/fmri/nilearn/glm/fir')
analysis_folder  = paste0("model51_iv-6cond_dv-firglasserSPM_ttl2_TPJ")
analysis_dir <-
  file.path(main_dir,
            "analysis",
            "mixedeffect",
            analysis_folder,
            as.character(Sys.Date())) # nolint
dir.create(analysis_dir,
           showWarnings = FALSE,
           recursive = TRUE)
savedir <- analysis_dir
```


```r
plot_timeseries_onefactor <-  function(df, iv1,  mean, error, xlab, ylab, ggtitle, color) {
    
n_points <- 100  # Number of points for interpolation
    g <- ggplot(
      data = df,
      aes(
        x = .data[[iv1]],
        y = .data[[mean]],
        group = 1,
        color = color
      ),
      cex.lab = 1.5,
      cex.axis = 2,
      cex.main = 1.5,
      cex.sub = 1.5
    ) +

      geom_errorbar(aes(
        ymin = (.data[[mean]] - .data[[error]]),
        ymax = (.data[[mean]] + .data[[error]]),
        color = color
      ), width = .1, alpha=0.8) +

      geom_line() +
      geom_point(color=color) +
      ggtitle(ggtitle) +
      xlab(xlab) +
      ylab(ylab) +

      theme_classic() +
      
      theme(aspect.ratio = .6) +
      expand_limits(x = 3.25) +

      scale_color_manual("",
                         values =  color) +
            # scale_fill_manual("",
                         # values =  color) +
      theme(
        legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.margin = margin(6, 6, 6, 6)
      ) +
      theme(legend.key = element_rect(fill = "white", colour = "white")) +
      theme_bw()
    
    return(g)
  }
```

## epoch: stim, high stim vs low stim

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high stim vs low stim
# ------------------------------------------------------------------------------
datadir = "/Users/h/Documents/projects_local/cue_expectancy/analysis/fmri/spm/fir/ttl2par"
taskname = "pain"
exclude <- "sub-0001"
filename <- paste0("sub-*", "*roi-TPJ_tr-42.csv")
  common_path <- Sys.glob(file.path(datadir, "sub-*",  filename
  ))
  filter_path <- common_path[!str_detect(common_path, pattern = exclude)]

df <- do.call("rbind.fill", lapply(filter_path, FUN = function(files) {
    read.table(files, header = TRUE, sep = ",")
    }))
```



```r
# filtered_df <- subset(df, condition != "rating")
filtered_df <- df[!(df$condition == "rating" | df$condition == "cue"), ]

parsed_df <- filtered_df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)

TR_length <- 42
# --------------------- subset regions based on ROI ----------------------------
df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "stim_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("stim_ordered", "tr_ordered"),
  idvar = "sub"
)
```

```
## 
## Attaching package: 'raincloudplots'
```

```
## The following object is masked _by_ '.GlobalEnv':
## 
##     GeomFlatViolin
```

```r
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "stim_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p1 = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High stim vs. Low stim", ggtitle="time_series", color=c("#5f0f40","#ae2012", "#fcbf49"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p1 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-4-1.png" width="672" />







### PCA subjectwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("tr_ordered", "stim_ordered"), 
                       names_from = "sub", 
                       values_from = "mean_per_sub")

df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("sub", "stim_ordered"), 
                       names_from = "tr_ordered", 
                       values_from = "mean_per_sub")
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
high.pca_result <- prcomp(meanhighdf)
high.pca_scores <- as.data.frame(high.pca_result$x)
# Access the proportion of variance explained by each principal component
high.variance_explained <- high.pca_result$sdev^2 / sum(high.pca_result$sdev^2)
plot(high.variance_explained)
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-5-1.png" width="672" />

```r
# Access the standard deviations of each principal component
high.stdev <- high.pca_result$sdev

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
low.pca <- prcomp(meanlowdf)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
```

```
## 
## Attaching package: 'plotly'
```

```
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
```

```
## The following objects are masked from 'package:plyr':
## 
##     arrange, mutate, rename, summarise
```

```
## The following object is masked from 'package:reshape':
## 
##     rename
```

```
## The following object is masked from 'package:stats':
## 
##     filter
```

```
## The following object is masked from 'package:graphics':
## 
##     layout
```

```r
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-84218737efb0c8dc9681" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-84218737efb0c8dc9681">{"x":{"visdat":{"abf22b8f27b4":["function () ","plotlyVisDat"]},"cur_data":"abf22b8f27b4","attrs":{"abf22b8f27b4":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[6.2504686218048597,-3.1918924995426865,14.510218386391102,-6.4599193957397878,-0.53273485598384818,15.500699531405038,-21.237127090222234,2.7309471830286336,4.7091856527837166,-7.8629508075973114,11.654481128996542,14.14638995609859,-17.915271201788752,4.1511104141701587,-9.8026733682984766,3.1780803416271257,-0.98152817732597675,-1.1962857661244244,-12.402482596649184,-7.7778021653983087,7.3094971579442696,-44.124325985185045,-21.737853627506492,-7.9048031491012436,13.109020281067332,-22.442820136768255,-7.3666551607514572,2.3923488295216719,11.097246671364434,-10.951947601553583,11.487757904953689,-6.5118231123438175,-1.6751937068293761,-3.3489165316993885,-39.01645998911949,-9.1167375186954303,19.075192553571458,28.157848369352767,4.0687327710641163,4.1284001461789153,-13.317735039154359,-2.820628600880533,8.8534213670688207,-5.0837846216806364,18.460954936975604,4.7743682587798082,-52.9204647550375,4.7864559754265317,-32.28890989167779,7.853602517505756,38.000956512207011,-12.97382480486392,30.677025784869254,-1.1217283087433398,-42.934786206884638,9.0217732253508593,9.3201694550131986,-18.31576586557841,20.409000201804854,-15.534098999688398,1.5102491257357189,11.412401666284666,3.8202996497917168,24.136371902443152,-28.910849807708928,21.002931294949182,-17.334460554425064,-15.953539272106928,8.5149315933821974,33.225770092061104,10.685053011308055,97.948625833081152,-12.955248113847793,-24.745719861014496,1.0465912965211923,18.148875574599256,-3.536246279512548,14.540289705977472,4.6365594407436141,8.3982259947398514,24.155754669106209,-12.968083958499207,7.6360052310371627,3.3827708973698378,8.8825229411766582,24.957229134674378,-3.3414072299725293,-34.124004926929508,-1.4873470689750354,60.901863338383919,1.0601761723104193,-0.80635983761424401,19.547300301011123,-49.840243770945754,10.62279789892038,-1.0107874810228874,-31.991648175369065,11.559275810110837,-16.488827248256342,-0.64111021913801647,-17.3701558451381,-30.084402427273943,6.994379369463088,7.4603910084916665,-34.221904905739336,-0.81852905801711884,13.188058775746775,14.556672563993923,10.223425885107925,-12.044936862378997,-2.4254098725486974],"y":[-3.1540065091782998,5.9518592773428765,-8.6324184620787179,1.1217585769410321,-2.2499203751505368,-17.406560111758829,-7.2443962220070679,-4.0032306431013804,6.8983400699736164,8.4879263950584036,-8.5692308449617762,-6.8565438775757697,16.361673450705908,4.2545123333497781,-7.5763985341473044,-16.976891794186074,-2.2406410574910898,-6.3445963074285388,-5.7854517681866611,18.852339335432902,-5.8244213517292049,1.3972178355159863,-1.1987765014484455,-7.9237061503703048,-13.319268352340092,16.822404269208707,9.302089477484289,-13.568564513802302,-10.576681221078893,3.4238166599115676,-9.8263491780280052,4.1924979076110969,4.2057686309228375,4.4034186715490975,7.8351122970084424,-2.7773184006517373,8.8921368303097719,-5.2917331109250938,-5.205172412000338,2.0136321210449046,0.07276792838636767,-8.5701676107491078,-9.6778122736725489,-5.2424868977026593,-16.269629462693803,-5.9473535045997536,26.939581816286122,-0.035894231032468867,4.7312720278549438,-6.3678419389535117,122.66809315765389,-2.6127275927478641,12.618116863920648,-5.3075018868684403,17.777926416627597,-14.185800599707582,-23.96237018719086,-19.961780450933585,27.995433071012513,-19.461841353263591,-0.89880401375562058,-1.9669346408979811,-0.95091247704838433,6.8141269429357063,-27.766664702472482,17.755859967242468,11.37542557155211,-1.7461764510516364,3.2353389307581288,-6.8940491386429725,-20.608491654522403,-4.1509897254248607,6.2260747154686102,18.237911814921581,-3.1472596508726345,-17.35548187175003,-18.714840943538746,4.0862426364706206,-2.1254701082478862,-10.343510953687137,-11.305155002821218,5.6842479294670616,10.319728917517807,-7.4630078360438938,-13.186923765524529,-7.4267134029513073,2.4793335989658165,24.163728044033373,11.822066048597856,-8.7853578669576731,7.4742874765968681,17.568801416508858,4.1152551310427912,-1.8994829287941866,-12.24588143963647,2.0125297336087353,5.1268823732557918,21.815809469058909,-3.3524267042245159,23.075395357629205,-15.681908228151297,-25.275159667065299,-9.0393902734016223,-15.981971506940525,-11.104002072551827,23.147494335252969,12.88432087358019,-3.4164800502736603,-3.8235922920789451,8.6817171786940541,-8.5097488252009565],"z":[3.8384489496371206,-6.1971488543461337,1.0777834851209593,-16.430190591532746,2.5703998880876946,-4.1998338206258019,-2.4075235138126372,-4.7022096738206551,0.77575869901711902,-2.6807135216975722,-2.491041874371263,-21.764247447917661,23.733861080406427,-5.4356406916058395,0.19346856111236976,6.9038579783164016,1.1265041677796928,4.0349386670619873,5.9062354346686865,4.3990002585061223,-4.7072996642203231,-15.880730310304392,0.71081797309252903,-10.863481963187818,-10.741538015585313,3.8861647673339337,12.359614708732641,-17.058982375346197,2.2250548085136654,-6.7527604193483937,-5.5980937972095761,-12.401235153374046,5.9784854414075959,-0.57359463724163506,-1.6785086998535932,14.160871451614456,-0.78355945155007733,-5.4471687173846783,-8.2424674408843064,-2.6342478408542189,0.65931019549610115,-0.68372406495734095,-1.5731242529937641,5.0333266685791758,3.2458845043954843,4.1811773936571237,-0.45725120981572392,6.0226325698434922,-4.490130780332958,-8.4264385942145452,-22.331727167165347,-1.4323504026738307,9.8134777383390706,2.7533877653801464,20.483484674651969,-2.221670439834321,6.619603585552758,-1.3358276320788911,-5.9004277714413647,-0.81130523620405226,4.5870575738794166,-0.9328674794754177,-2.1073567466377487,3.6609580824083472,-18.965668264327103,5.6128579980992015,23.797630474287679,3.7576637437656606,8.5903051022742822,-24.31566906045909,-4.5451602380499576,5.355291591707048,11.395224963628451,11.318414155680165,8.2428801963410141,7.7328204045165165,-2.7867328757869356,-3.1587870293370908,0.69190263818986597,-4.2006287736406636,11.694497240453863,-5.7194662354780652,9.6099689127601966,10.74681919897421,5.6468378310690799,-6.003596211475914,-1.8917258344797354,5.6089009154164584,2.6219654277508613,5.0826204418315593,8.2864499096085922,-20.835149232947384,7.1741867596505324,-11.745868148189269,3.0765084984332534,1.0592520207700722,2.8650703868175675,-19.881919322414003,4.8448164669252405,5.6957746264608593,-9.2054046029380174,-14.583648649740175,-2.3422087963240115,9.7593325448463411,-3.7965531157313874,14.096384965275849,14.190382670629335,0.53768032809474975,16.590484053815331,-10.770677497438719,0.50079260199138775],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-22.335809278115132,41.316327664299891,-19.043237628055056,-11.930216907798364,3.4605765651469245,-28.492628482108152,30.91557122435988,0.60498332414373912,-4.3463147733486096,12.45231499754224,-18.982443417044756,2.2263426921448386,13.147115076561429,8.4949037060374959,-6.986867889758769,-20.326679455225786,35.14584953886672,8.8636611845535551,15.681974818278471,27.326719727012016,4.1150145551842705,29.528753289299349,5.6038197746750544,1.1792241589533543,-7.3737360111486971,5.8325418429943916,-7.5211404373398283,-17.76750726260267,3.5608269635182821,1.956634086423034,-16.107678316338475,20.538214705962833,-8.2931427570403091,-6.5151917629257055,43.265114599248051,17.71876784443344,-5.3881457170050542,-15.965289218339647,-27.1919254857829,-36.651902435906891,17.377505899229522,-12.919353410578205,-12.902933546388924,-6.6219684684327884,-23.089646380078893,0.25522781356524649,51.572495809300612,-0.83436835683520449,23.829212243857739,3.6623772294432961,-31.240178618976802,14.557122018263442,-8.3457126929465009,4.8162901107379241,35.459321622534659,-3.4902720151464748,-40.510688926959524,-4.5830416131646938,6.9098265010380056,16.688619388593104,-15.56114376656928,-18.512357836468343,-11.994676368098,12.405171071539984,15.179491392520488,-16.072013446634838,-2.537296558899949,7.9012208715261014,-1.7426661075291405,29.465909786271531,-10.103558863662776,-75.064213695888199,7.8152737742298957,24.530385542150007,4.8510320241788447,4.3883886178972888,3.0710517531917478,-12.037878110419291,-20.802583634344444,-4.3000551764604102,-16.494921514106448,6.7410088985746404,-3.7682804029511625,1.0284944583194793,-9.0367242661564422,1.3129044654039601,0.38369881730147393,32.497890452000284,6.0438879204743401,-53.582581839983753,1.4608384484944898,5.2032673936187912,-34.629268335145106,29.677450170242242,-11.806428575646109,14.960053427760926,-28.045881330192032,-5.8909215489192359,25.932294308238529,-0.00069656868551138252,2.3565381140257298,28.035222683437926,-6.7880180003554234,-5.8762248492449372,29.887494138699438,9.288716327528082,-13.553658477463999,-4.6027789219487367,-3.8292033661073179,13.611269129834442,-13.700152136389647],"y":[-3.4675404571394233,-0.62067785196082847,-11.2455605782484,5.990866722627687,1.5827451951566955,-3.525190167287839,1.2927981982751287,-6.7397187611578122,5.7961057005799139,2.7879784130156229,6.2879066766201355,-4.5256276193711003,20.499907301438732,10.385564895018105,-4.5402239304047312,-10.888434104167455,-24.178811936674926,-7.4451914903111609,-8.2530170128177236,10.39469302817449,0.65065354398217268,-21.181510487343267,-2.8002973566924281,-1.4567223014021888,-8.9724297135894577,-3.4101588512020218,1.2753114394154819,-23.197415944979667,-5.1259989597271876,-10.372929277686502,-6.3185108325678474,-12.732685460819759,1.6132163723538713,-6.1954386462212137,-2.8358434477563281,7.671779182094955,27.061074966786496,-4.18291399096832,-6.6430768221925032,-21.117244930450799,-2.0015518132658059,-9.9871853695269373,3.3992092323105423,0.13372148835465256,-11.289455018237138,-5.1635550595463471,23.405715613152566,-3.9631950837450347,-2.3195594774944377,1.0632276457216603,64.661086550438782,8.8104071373125219,14.415296585824329,4.4384246389155209,6.537573492815838,-17.809890125357065,-9.7573364050597409,-9.1116986073030759,8.1321895356885108,-27.425075528079045,-2.2983286904687192,-0.58145596333957594,-3.7496687579900927,5.6907184674181126,-15.903882653359291,14.77176792505591,0.87327033669854914,4.1873154643607498,8.0447327561477149,-2.1280416345211228,9.9816033156949224,12.210860979732168,12.066857391832952,15.299820880659178,-2.4117476721211131,-1.2197410430956181,6.9579339190348106,9.628553948219583,1.9892530220375908,2.6484778695102196,6.4522250345566938,-4.6923406970862329,16.748835210478685,-8.8802821292650584,2.385875878928001,5.3928204696443416,-2.0295035435958289,15.003846185381157,3.8400748115837828,-6.1509165357647948,12.741330759927974,-0.84392767842186778,1.8746855895365926,12.270993957857721,-3.3483736592617932,1.7366167073940733,-9.7745199520609702,-1.6734496546307907,-6.4490809926539203,20.294716148522369,-13.768026991477983,-18.606764347272804,-2.2371166946973617,-7.9195281410895602,-4.1198589082242734,26.295347071269571,3.9818068805279681,-3.4909579955963363,-13.122723491920619,-10.52758158539484,-4.928301704019737],"z":[5.414205353040443,1.4296816469573466,-9.916001801861924,-8.956330759235291,4.7048991923387131,-4.2142428689864699,1.4158056345671219,-7.1231749678438199,-3.8267898261096285,-8.2201268375956555,6.4922776954397676,4.332797692334629,2.0155239453486269,0.69708084764408551,-5.8866654872468782,-1.3414080981596281,21.224115710324909,7.1445906473453489,10.074662147258715,-2.8193880768352537,4.1096021716320053,-12.305816894265817,-7.5384758087028887,-17.008636213550936,-0.24922081041350633,2.4774422185609546,3.4298333925400812,-13.716927893886348,14.122400567700687,0.61496220218787601,-1.8141898913975671,-11.739133606536122,4.4582821009556399,-4.0181065178632149,-9.9253659534163621,1.5018203722662449,-4.9726679596491685,-2.9149786267272306,-4.9839862618342581,1.2736399565574821,4.5094373269472081,-3.5958102980928621,1.4727348911380951,3.3864385185306296,1.2604042193778622,13.367979651301917,-13.356889574337453,6.681882176690892,-3.3863002824113506,-6.562661098514825,12.524676694929019,-0.38486464210977667,-1.7511960935815167,-4.1626527531502617,8.6716679287833234,-0.42866077756072801,-9.4286664235658346,-1.6176144446337,4.1407270011435289,1.7160253134729007,-3.1949203189908713,2.3586438227215756,-2.6274287737617841,6.7302327842402514,-5.9042866987549756,-3.2340545792554929,4.0689971669287139,-3.4501088793971326,5.3404569954970853,2.9444005204817172,-0.55400037046853412,-7.632699872877093,-0.75171452552318674,-4.5785152532789146,2.8329440401712711,17.983369040107952,15.530255173826189,-1.0587009287742806,-8.2841281984787738,-5.0231554452205884,4.608037947113929,-10.201112222530597,-4.6838272577126103,6.9170638442797996,2.592502102811955,8.8408274240264095,-6.8377018280898794,-7.9701714447204788,-9.1258108514518099,10.564697868980813,1.2006692919173008,-14.971355961739285,3.41052957974434,-15.58192494740484,4.2327953061210195,5.4215658366336115,-5.8687245764580398,3.0666546772862011,18.632738077646959,-0.79611396120264699,-7.6455298488021395,5.560520472067207,-2.6475149584478737,11.799021448787817,-2.2938704183143259,2.0647333460374981,1.0344604073655699,4.8959060175495388,15.060807564940783,-2.9257841160746656,3.6516798132055834],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints
```

### PCA groupwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide.group <- pivot_wider(subjectwise,
                       id_cols = c("tr_ordered", "stim_ordered"),
                       names_from = "sub",
                       values_from = "mean_per_sub")
# ------
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# datapoints <- df_ordered$mean_per_sub_norm_mean
# data_df <- data.frame(Dim1 = datapoints, Dim2 = datapoints, Dim3 = datapoints)
# pca <- prcomp(data_df)
# pca_scores <- as.data.frame(pca$x)
# plot_ly(pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# -------
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
high.pca <- prcomp(meanhighdf)
high.pca_scores <- as.data.frame(high.pca$x)

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
low.pca <- prcomp(meanlowdf)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7d9991da584032fc2f01" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-7d9991da584032fc2f01">{"x":{"visdat":{"abf266f5f4cf":["function () ","plotlyVisDat"]},"cur_data":"abf266f5f4cf","attrs":{"abf266f5f4cf":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[6.2504686218048597,-3.1918924995426865,14.510218386391102,-6.4599193957397878,-0.53273485598384818,15.500699531405038,-21.237127090222234,2.7309471830286336,4.7091856527837166,-7.8629508075973114,11.654481128996542,14.14638995609859,-17.915271201788752,4.1511104141701587,-9.8026733682984766,3.1780803416271257,-0.98152817732597675,-1.1962857661244244,-12.402482596649184,-7.7778021653983087,7.3094971579442696,-44.124325985185045,-21.737853627506492,-7.9048031491012436,13.109020281067332,-22.442820136768255,-7.3666551607514572,2.3923488295216719,11.097246671364434,-10.951947601553583,11.487757904953689,-6.5118231123438175,-1.6751937068293761,-3.3489165316993885,-39.01645998911949,-9.1167375186954303,19.075192553571458,28.157848369352767,4.0687327710641163,4.1284001461789153,-13.317735039154359,-2.820628600880533,8.8534213670688207,-5.0837846216806364,18.460954936975604,4.7743682587798082,-52.9204647550375,4.7864559754265317,-32.28890989167779,7.853602517505756,38.000956512207011,-12.97382480486392,30.677025784869254,-1.1217283087433398,-42.934786206884638,9.0217732253508593,9.3201694550131986,-18.31576586557841,20.409000201804854,-15.534098999688398,1.5102491257357189,11.412401666284666,3.8202996497917168,24.136371902443152,-28.910849807708928,21.002931294949182,-17.334460554425064,-15.953539272106928,8.5149315933821974,33.225770092061104,10.685053011308055,97.948625833081152,-12.955248113847793,-24.745719861014496,1.0465912965211923,18.148875574599256,-3.536246279512548,14.540289705977472,4.6365594407436141,8.3982259947398514,24.155754669106209,-12.968083958499207,7.6360052310371627,3.3827708973698378,8.8825229411766582,24.957229134674378,-3.3414072299725293,-34.124004926929508,-1.4873470689750354,60.901863338383919,1.0601761723104193,-0.80635983761424401,19.547300301011123,-49.840243770945754,10.62279789892038,-1.0107874810228874,-31.991648175369065,11.559275810110837,-16.488827248256342,-0.64111021913801647,-17.3701558451381,-30.084402427273943,6.994379369463088,7.4603910084916665,-34.221904905739336,-0.81852905801711884,13.188058775746775,14.556672563993923,10.223425885107925,-12.044936862378997,-2.4254098725486974],"y":[-3.1540065091782998,5.9518592773428765,-8.6324184620787179,1.1217585769410321,-2.2499203751505368,-17.406560111758829,-7.2443962220070679,-4.0032306431013804,6.8983400699736164,8.4879263950584036,-8.5692308449617762,-6.8565438775757697,16.361673450705908,4.2545123333497781,-7.5763985341473044,-16.976891794186074,-2.2406410574910898,-6.3445963074285388,-5.7854517681866611,18.852339335432902,-5.8244213517292049,1.3972178355159863,-1.1987765014484455,-7.9237061503703048,-13.319268352340092,16.822404269208707,9.302089477484289,-13.568564513802302,-10.576681221078893,3.4238166599115676,-9.8263491780280052,4.1924979076110969,4.2057686309228375,4.4034186715490975,7.8351122970084424,-2.7773184006517373,8.8921368303097719,-5.2917331109250938,-5.205172412000338,2.0136321210449046,0.07276792838636767,-8.5701676107491078,-9.6778122736725489,-5.2424868977026593,-16.269629462693803,-5.9473535045997536,26.939581816286122,-0.035894231032468867,4.7312720278549438,-6.3678419389535117,122.66809315765389,-2.6127275927478641,12.618116863920648,-5.3075018868684403,17.777926416627597,-14.185800599707582,-23.96237018719086,-19.961780450933585,27.995433071012513,-19.461841353263591,-0.89880401375562058,-1.9669346408979811,-0.95091247704838433,6.8141269429357063,-27.766664702472482,17.755859967242468,11.37542557155211,-1.7461764510516364,3.2353389307581288,-6.8940491386429725,-20.608491654522403,-4.1509897254248607,6.2260747154686102,18.237911814921581,-3.1472596508726345,-17.35548187175003,-18.714840943538746,4.0862426364706206,-2.1254701082478862,-10.343510953687137,-11.305155002821218,5.6842479294670616,10.319728917517807,-7.4630078360438938,-13.186923765524529,-7.4267134029513073,2.4793335989658165,24.163728044033373,11.822066048597856,-8.7853578669576731,7.4742874765968681,17.568801416508858,4.1152551310427912,-1.8994829287941866,-12.24588143963647,2.0125297336087353,5.1268823732557918,21.815809469058909,-3.3524267042245159,23.075395357629205,-15.681908228151297,-25.275159667065299,-9.0393902734016223,-15.981971506940525,-11.104002072551827,23.147494335252969,12.88432087358019,-3.4164800502736603,-3.8235922920789451,8.6817171786940541,-8.5097488252009565],"z":[3.8384489496371206,-6.1971488543461337,1.0777834851209593,-16.430190591532746,2.5703998880876946,-4.1998338206258019,-2.4075235138126372,-4.7022096738206551,0.77575869901711902,-2.6807135216975722,-2.491041874371263,-21.764247447917661,23.733861080406427,-5.4356406916058395,0.19346856111236976,6.9038579783164016,1.1265041677796928,4.0349386670619873,5.9062354346686865,4.3990002585061223,-4.7072996642203231,-15.880730310304392,0.71081797309252903,-10.863481963187818,-10.741538015585313,3.8861647673339337,12.359614708732641,-17.058982375346197,2.2250548085136654,-6.7527604193483937,-5.5980937972095761,-12.401235153374046,5.9784854414075959,-0.57359463724163506,-1.6785086998535932,14.160871451614456,-0.78355945155007733,-5.4471687173846783,-8.2424674408843064,-2.6342478408542189,0.65931019549610115,-0.68372406495734095,-1.5731242529937641,5.0333266685791758,3.2458845043954843,4.1811773936571237,-0.45725120981572392,6.0226325698434922,-4.490130780332958,-8.4264385942145452,-22.331727167165347,-1.4323504026738307,9.8134777383390706,2.7533877653801464,20.483484674651969,-2.221670439834321,6.619603585552758,-1.3358276320788911,-5.9004277714413647,-0.81130523620405226,4.5870575738794166,-0.9328674794754177,-2.1073567466377487,3.6609580824083472,-18.965668264327103,5.6128579980992015,23.797630474287679,3.7576637437656606,8.5903051022742822,-24.31566906045909,-4.5451602380499576,5.355291591707048,11.395224963628451,11.318414155680165,8.2428801963410141,7.7328204045165165,-2.7867328757869356,-3.1587870293370908,0.69190263818986597,-4.2006287736406636,11.694497240453863,-5.7194662354780652,9.6099689127601966,10.74681919897421,5.6468378310690799,-6.003596211475914,-1.8917258344797354,5.6089009154164584,2.6219654277508613,5.0826204418315593,8.2864499096085922,-20.835149232947384,7.1741867596505324,-11.745868148189269,3.0765084984332534,1.0592520207700722,2.8650703868175675,-19.881919322414003,4.8448164669252405,5.6957746264608593,-9.2054046029380174,-14.583648649740175,-2.3422087963240115,9.7593325448463411,-3.7965531157313874,14.096384965275849,14.190382670629335,0.53768032809474975,16.590484053815331,-10.770677497438719,0.50079260199138775],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-22.335809278115132,41.316327664299891,-19.043237628055056,-11.930216907798364,3.4605765651469245,-28.492628482108152,30.91557122435988,0.60498332414373912,-4.3463147733486096,12.45231499754224,-18.982443417044756,2.2263426921448386,13.147115076561429,8.4949037060374959,-6.986867889758769,-20.326679455225786,35.14584953886672,8.8636611845535551,15.681974818278471,27.326719727012016,4.1150145551842705,29.528753289299349,5.6038197746750544,1.1792241589533543,-7.3737360111486971,5.8325418429943916,-7.5211404373398283,-17.76750726260267,3.5608269635182821,1.956634086423034,-16.107678316338475,20.538214705962833,-8.2931427570403091,-6.5151917629257055,43.265114599248051,17.71876784443344,-5.3881457170050542,-15.965289218339647,-27.1919254857829,-36.651902435906891,17.377505899229522,-12.919353410578205,-12.902933546388924,-6.6219684684327884,-23.089646380078893,0.25522781356524649,51.572495809300612,-0.83436835683520449,23.829212243857739,3.6623772294432961,-31.240178618976802,14.557122018263442,-8.3457126929465009,4.8162901107379241,35.459321622534659,-3.4902720151464748,-40.510688926959524,-4.5830416131646938,6.9098265010380056,16.688619388593104,-15.56114376656928,-18.512357836468343,-11.994676368098,12.405171071539984,15.179491392520488,-16.072013446634838,-2.537296558899949,7.9012208715261014,-1.7426661075291405,29.465909786271531,-10.103558863662776,-75.064213695888199,7.8152737742298957,24.530385542150007,4.8510320241788447,4.3883886178972888,3.0710517531917478,-12.037878110419291,-20.802583634344444,-4.3000551764604102,-16.494921514106448,6.7410088985746404,-3.7682804029511625,1.0284944583194793,-9.0367242661564422,1.3129044654039601,0.38369881730147393,32.497890452000284,6.0438879204743401,-53.582581839983753,1.4608384484944898,5.2032673936187912,-34.629268335145106,29.677450170242242,-11.806428575646109,14.960053427760926,-28.045881330192032,-5.8909215489192359,25.932294308238529,-0.00069656868551138252,2.3565381140257298,28.035222683437926,-6.7880180003554234,-5.8762248492449372,29.887494138699438,9.288716327528082,-13.553658477463999,-4.6027789219487367,-3.8292033661073179,13.611269129834442,-13.700152136389647],"y":[-3.4675404571394233,-0.62067785196082847,-11.2455605782484,5.990866722627687,1.5827451951566955,-3.525190167287839,1.2927981982751287,-6.7397187611578122,5.7961057005799139,2.7879784130156229,6.2879066766201355,-4.5256276193711003,20.499907301438732,10.385564895018105,-4.5402239304047312,-10.888434104167455,-24.178811936674926,-7.4451914903111609,-8.2530170128177236,10.39469302817449,0.65065354398217268,-21.181510487343267,-2.8002973566924281,-1.4567223014021888,-8.9724297135894577,-3.4101588512020218,1.2753114394154819,-23.197415944979667,-5.1259989597271876,-10.372929277686502,-6.3185108325678474,-12.732685460819759,1.6132163723538713,-6.1954386462212137,-2.8358434477563281,7.671779182094955,27.061074966786496,-4.18291399096832,-6.6430768221925032,-21.117244930450799,-2.0015518132658059,-9.9871853695269373,3.3992092323105423,0.13372148835465256,-11.289455018237138,-5.1635550595463471,23.405715613152566,-3.9631950837450347,-2.3195594774944377,1.0632276457216603,64.661086550438782,8.8104071373125219,14.415296585824329,4.4384246389155209,6.537573492815838,-17.809890125357065,-9.7573364050597409,-9.1116986073030759,8.1321895356885108,-27.425075528079045,-2.2983286904687192,-0.58145596333957594,-3.7496687579900927,5.6907184674181126,-15.903882653359291,14.77176792505591,0.87327033669854914,4.1873154643607498,8.0447327561477149,-2.1280416345211228,9.9816033156949224,12.210860979732168,12.066857391832952,15.299820880659178,-2.4117476721211131,-1.2197410430956181,6.9579339190348106,9.628553948219583,1.9892530220375908,2.6484778695102196,6.4522250345566938,-4.6923406970862329,16.748835210478685,-8.8802821292650584,2.385875878928001,5.3928204696443416,-2.0295035435958289,15.003846185381157,3.8400748115837828,-6.1509165357647948,12.741330759927974,-0.84392767842186778,1.8746855895365926,12.270993957857721,-3.3483736592617932,1.7366167073940733,-9.7745199520609702,-1.6734496546307907,-6.4490809926539203,20.294716148522369,-13.768026991477983,-18.606764347272804,-2.2371166946973617,-7.9195281410895602,-4.1198589082242734,26.295347071269571,3.9818068805279681,-3.4909579955963363,-13.122723491920619,-10.52758158539484,-4.928301704019737],"z":[5.414205353040443,1.4296816469573466,-9.916001801861924,-8.956330759235291,4.7048991923387131,-4.2142428689864699,1.4158056345671219,-7.1231749678438199,-3.8267898261096285,-8.2201268375956555,6.4922776954397676,4.332797692334629,2.0155239453486269,0.69708084764408551,-5.8866654872468782,-1.3414080981596281,21.224115710324909,7.1445906473453489,10.074662147258715,-2.8193880768352537,4.1096021716320053,-12.305816894265817,-7.5384758087028887,-17.008636213550936,-0.24922081041350633,2.4774422185609546,3.4298333925400812,-13.716927893886348,14.122400567700687,0.61496220218787601,-1.8141898913975671,-11.739133606536122,4.4582821009556399,-4.0181065178632149,-9.9253659534163621,1.5018203722662449,-4.9726679596491685,-2.9149786267272306,-4.9839862618342581,1.2736399565574821,4.5094373269472081,-3.5958102980928621,1.4727348911380951,3.3864385185306296,1.2604042193778622,13.367979651301917,-13.356889574337453,6.681882176690892,-3.3863002824113506,-6.562661098514825,12.524676694929019,-0.38486464210977667,-1.7511960935815167,-4.1626527531502617,8.6716679287833234,-0.42866077756072801,-9.4286664235658346,-1.6176144446337,4.1407270011435289,1.7160253134729007,-3.1949203189908713,2.3586438227215756,-2.6274287737617841,6.7302327842402514,-5.9042866987549756,-3.2340545792554929,4.0689971669287139,-3.4501088793971326,5.3404569954970853,2.9444005204817172,-0.55400037046853412,-7.632699872877093,-0.75171452552318674,-4.5785152532789146,2.8329440401712711,17.983369040107952,15.530255173826189,-1.0587009287742806,-8.2841281984787738,-5.0231554452205884,4.608037947113929,-10.201112222530597,-4.6838272577126103,6.9170638442797996,2.592502102811955,8.8408274240264095,-6.8377018280898794,-7.9701714447204788,-9.1258108514518099,10.564697868980813,1.2006692919173008,-14.971355961739285,3.41052957974434,-15.58192494740484,4.2327953061210195,5.4215658366336115,-5.8687245764580398,3.0666546772862011,18.632738077646959,-0.79611396120264699,-7.6455298488021395,5.560520472067207,-2.6475149584478737,11.799021448787817,-2.2938704183143259,2.0647333460374981,1.0344604073655699,4.8959060175495388,15.060807564940783,-2.9257841160746656,3.6516798132055834],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints

# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
# combined_pca <- combined_pca_scores %>%
  # mutate(group_index = group_indices(., stim_ordered))

combined_pca <- combined_pca_scores %>%
  group_by(stim_ordered) %>%
  mutate(group_index = row_number())
ggplot(combined_pca, aes(x=group_index,y=PC1, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-6-2.png" width="672" />



```r
# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-7-1.png" width="672" />

```r
# ggplot(data=groupwise, aes(x=tr_ordered, y=mean_per_sub_mean, ymin=se, ymax=se, fill=stim_ordered, linetype=stim_ordered)) + 
#  geom_line() + 
#  geom_ribbon(alpha=0.5)  
# Assuming you have a dataframe named 'data' containing the 20 mean data points and corresponding standard errors
# 'x' represents the x-values (e.g., time points)
# 'mean_y' represents the mean y-values
# 'se_y' represents the standard errors of the mean y-values

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)
# groupwise$x <- as.numeric(groupwise$x)
# 
# # Sort the dataframe by the 'x' variable (if it's not already sorted)
# data <- data[order(data$x), ]

# Create the plot
# Create the plot with custom span and smoothing method
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean)) +
  geom_line() +                                   # Plot the smooth line for the mean
  geom_ribbon(aes(ymin = mean_per_sub_mean - se, ymax = mean_per_sub_mean + se), alpha = 0.3) + # Add the ribbon for standard error
  geom_smooth(method = "loess", span = 0.1, se = FALSE) +       # Add the loess smoothing curve
  labs(x = "X-axis Label", y = "Y-axis Label", title = "Smooth Line with Standard Error Ribbon") +
  theme_minimal()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-8-1.png" width="672" />



## epoch: stim, high cue vs low cue


```r
# filtered_df <- subset(df, condition != "rating")
filtered_df <- df[!(df$condition == "rating" | df$condition == "cue"), ]

parsed_df <- filtered_df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)

TR_length <- 42
# --------------------- subset regions based on ROI ----------------------------
df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH","cueL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "cue_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("cue_ordered", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "cue_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p1 = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("red", "blue"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p1 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-9-1.png" width="672" />


### PCA subjectwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("tr_ordered", "cue_ordered"), 
                       names_from = "sub", 
                       values_from = "mean_per_sub")

df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("sub", "cue_ordered"), 
                       names_from = "tr_ordered", 
                       values_from = "mean_per_sub")
cue_high.df <- df_wide[df_wide$cue_ordered == "cueH",]
stim_low.df <- df_wide[df_wide$cue_ordered == "cueL",]
# selected_columns <- subset(cue_high.df, select = 2:(ncol(cue_high.df) - 1))
meanhighdf <- data.frame(subset(cue_high.df, select = 3:(ncol(cue_high.df) - 1)))
high.pca_result <- prcomp(meanhighdf)
high.pca_scores <- as.data.frame(high.pca_result$x)
# Access the proportion of variance explained by each principal component
high.variance_explained <- high.pca_result$sdev^2 / sum(high.pca_result$sdev^2)
plot(high.variance_explained)
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-10-1.png" width="672" />

```r
# Access the standard deviations of each principal component
high.stdev <- high.pca_result$sdev

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
low.pca <- prcomp(meanlowdf)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$cum_ordered <- c(rep("high_cue", nrow(high.pca_scores)), rep("low_cue", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~cum_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-33e56a8bc07a6c1cfcdc" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-33e56a8bc07a6c1cfcdc">{"x":{"visdat":{"abf2295ff1f0":["function () ","plotlyVisDat"]},"cur_data":"abf2295ff1f0","attrs":{"abf2295ff1f0":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-21.633750495005259,22.771300890644842,-6.3620709677296157,18.134175456845728,3.227652365012494,-18.471081319976495,27.289663624951906,-14.658291616733917,-4.6996741958773161,10.193840862548265,-13.50277101709535,0.68342849769197267,13.015065689309036,5.8012128571463961,2.6269884426264181,-8.0373057284148555,35.633489231615329,3.1951975647016524,16.123717692837864,28.763415962025963,1.6029610203979048,34.822767287321078,9.9129618827959618,2.6765931548192166,-11.408115621028637,18.796490635479504,-8.0949611617511508,-9.5053300054360825,-6.0272366351242015,-0.5182712833902885,-18.082427692134999,13.227434345539111,-2.5700273928978707,-4.1969764415101523,36.993034379140717,9.6840466570054247,-20.291843319500384,-21.160874503292764,-19.252071860637038,-29.768821384608959,19.263144825167885,-6.0017339576013962,-12.687331856100176,-0.83807807024396541,-12.092974521930588,-2.3860778561808957,50.163387181552658,-1.8158469700914794,28.334898287470221,0.51246290560104757,-7.8675498652357376,0.79760535702021385,-28.413130430217855,8.618208695488482,40.806861882165535,-11.869437581907402,-23.941533863604135,13.001215274266331,-10.366371074369027,20.616579345894127,-12.102511349509477,-9.4631775406985561,-6.6998776136434524,-7.7291201683535444,15.736911039657976,-9.0126782238707168,-9.6508263508134871,9.2563077627410646,-11.256901609634831,-18.058389241264447,-11.768175435140467,-82.632610895705341,5.3777611158875436,25.734195966068402,-0.10344062592828249,-6.0629457842781074,1.866655450776288,-19.578541792065984,-18.183164474364919,-8.111169641140819,-24.904523585138019,14.079976396784211,-4.9739962081133866,1.8166034734761063,-7.3137548474751393,-9.4275425806426743,6.4089623631803727,36.747019070566431,1.1300996046542433,-49.944098979080721,4.7140241872869924,8.0647443794742024,-32.945937548244579,43.008819008427466,-7.0879060852335147,5.9354056568567595,17.902844838578826,-20.407384874989031,19.710228613140778,-9.3275812098146975,9.3928788081265591,37.702801278888415,-10.509830507541016,-4.5537454049124717,34.648112646792448,3.9309441293830578,-23.891614687430692,-7.2970364937390695,-11.382892175105614,17.209385143395217,-6.761138565725556],"y":[-0.93636836635986553,4.6273003574140441,-6.4951524393740501,12.972439691684709,1.1910375053833659,-12.249388036076011,-4.1442207218861418,-5.624325240491058,7.1328345809123173,1.5225776151495813,-6.4665761177680086,-11.553975854905763,31.423719561956894,-7.5807429324746067,-7.6816888137523449,-13.002634053660433,-3.9538312616826454,-8.6954487747343574,-15.219160485374555,23.083399020110708,0.063446393735395998,-18.504491760777039,-4.1203074409466298,-4.1762238083248011,-12.100859060800017,4.4177247230698287,4.6999925676581595,-14.002259976540671,-8.4632440808700533,-3.9568447643596554,-7.6607986286874992,-3.7949336530421394,3.2348120117011225,-4.7166664696166825,11.453925748587999,9.4587570305668365,11.602466629597281,-0.70271136882777285,-8.3784535969749516,-14.067005814813319,2.3702980329710019,-8.5407501371755199,-3.9989415881112924,-2.2896577861971004,-11.806293607821079,-6.3203114806912088,20.174344542601474,-3.8915766089284043,5.5801731945067683,0.1301856972265866,75.094084147488658,-4.368692652064146,24.560444693463275,0.027888628080957899,13.084142409515861,-19.892336784539943,-20.373567428994271,-18.541746365825762,18.510323559105569,-29.119796099262086,3.8457095368976018,-1.3862279328595448,-8.2173341407876244,9.8527367785248341,-19.151631353772245,18.050775338345382,-8.9430768053659939,3.6704192537215357,5.5608327642968067,5.4774770397261516,1.9385453431586179,10.81770694714511,8.6853996694911526,17.613620442771918,-5.0328810941993085,-3.4838647302625545,-9.4635983663326844,11.647839162335778,5.6371586252380776,-1.0628435350439607,2.4842428453795531,-0.20691939162952253,18.728812085143645,-3.9708402221616996,-1.2654729636688529,3.5471909878806436,0.34991333507872374,18.177345262538626,8.0068048973765205,-4.2831462949554986,11.647916831196207,8.6741466427027731,4.4690819227139134,11.199802147402965,-14.237574978935083,3.2622574866995788,-13.39836086995744,6.1055627509837009,-12.859814171487654,25.56021594540946,-12.368635400104777,-25.025773495563133,-0.35087370464791001,-13.153472839841349,-15.794744022518168,26.460130159206258,9.4825821959469589,-4.6243828192238281,-13.344603371963629,-8.488821928749168,-9.8636662430374518],"z":[9.9193910377796364,-3.4635505063669378,-2.9653598327263637,-12.11649283803469,5.7720065055418805,-0.28116753903635983,7.0675604118535356,-15.274478234462084,0.572028088274254,-1.0551560059726934,3.9189451759838048,-5.5633833586180073,15.623137665005657,-5.8613933913343006,-1.2679390674651465,9.252586322740159,27.363008178989247,7.0974350029200419,7.8691707078936641,4.1142130400837615,-1.584725003957242,-15.720939067893374,-0.65713988393419953,-14.873999600071166,-6.1736623568985483,-2.5735816689731186,1.2122381356468273,-12.833389200810061,6.5023175218015865,-3.3621611428054621,-2.7389938714299449,-19.678782807482467,4.5958466383461145,-2.1977909088894245,-10.350617191894919,4.7153890977170638,-7.7747409820783275,-7.4714364704857736,-3.5461472617608538,-9.5461654828931319,2.8681890013016949,3.1463316154625378,0.81734562352362916,5.4230549662612137,2.7047825370254088,4.9814566927299104,-10.844077579383482,5.3073881519159158,-8.2598987761829665,-3.1680338474403609,-0.25038711199749347,-2.2051023860004868,-1.3149224488387123,3.2388914461755443,16.631417211679896,-1.0124369352527454,2.6125495079946108,0.072992377666078676,0.15349348929414489,-1.0712362387289112,-2.0039612039640717,6.3604104278693399,-3.7596144317137168,1.205062037504244,-13.638090775202445,7.5271851307814686,1.0105026394890841,-0.79515100450691978,6.461593765692716,-10.281473161243824,-0.17889031985416967,-7.0203521078327471,5.6148218676697015,1.1739542214752812,8.4001455400544867,20.997207552152339,-0.15777246300613021,-2.9722302009334887,-2.0504621024584155,-1.744324583459081,2.9283910308598435,-9.2976997852655572,2.9016195456964065,6.6886583865596059,6.773818530922588,2.3532179741109185,-4.8032117738648976,-0.064052205001802115,-5.2161343922748262,5.208383093450931,8.579737113519986,-19.949536390146037,-3.7441770080698631,-18.933514501127469,7.5771720729571763,6.4812879225861257,-2.3959260016872514,-14.691119531611903,16.737408603753078,-9.1347656944506923,-8.2067348614561677,2.1101511260562904,-2.6574797027828798,17.393672634855861,2.3373034003915847,13.87705402855376,4.6149493111390747,3.8196989722022039,11.699098942709636,-8.8759756598790656,5.2462668372715413],"mode":"markers","type":"scatter3d","name":"high_cue","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[0.39712822437773104,24.207431704793429,-20.320115800776229,0.0033427858752273837,3.0249486039323763,-26.724497251404497,25.886224685618224,10.664372455841248,-1.6133888173517215,14.716226532926491,-23.657824720289216,-15.493870067495065,30.162875547049953,2.6962590964153552,-5.1024383843533618,-13.458441725348038,0.89815403980262309,3.8521268848679195,14.693312939608667,7.9600444417858416,-0.48817580205862776,47.780475971109198,10.41700857214078,3.6952577868803571,-12.673615317329162,10.108095225201083,13.476291264520526,-3.6843773270060165,-8.3702458039316117,8.2269194429351913,-13.485521632237644,11.764735165648789,-1.5753516231995954,-1.5294370810744888,41.005127335345435,3.2673481587647073,-7.5981559012007169,-18.900347394284395,-12.260017535917818,-14.221320154189387,19.280301380793912,-5.5042967179107398,-16.791063893382415,-6.7363532942826323,-27.646656462890192,-6.5104693280226087,49.749093969380354,-6.0649375575720592,29.982248687730074,0.41017498905051875,6.935019733694717,4.3880828935042215,-9.9859044446281828,0.27775614385034447,40.903738559150838,-0.43210737040273428,-29.437950967296537,-2.6272099503720732,-2.9327508591595999,20.549903511539952,-7.7971628415518035,-9.8647714849066297,-4.0645192933406786,-5.523339456806462,23.182572568514509,-21.582910535623924,12.318924276150563,17.849598430769976,-6.4282133307468623,17.719981730141896,-19.10296748947335,-88.288520333053285,13.131151119754968,22.342533428186147,4.525455080742967,-16.674675723289038,-2.6190929996990091,-11.054371201553192,-14.303072693699718,-3.6063711743041957,-31.279653448170134,8.3136646566751349,-5.4035465870364918,-3.855556212153243,-13.507882327556452,-7.9353623581484722,1.8982425746082481,39.409914372101909,3.114900291706125,-57.271256839659479,-1.43154632676242,4.330147405693169,-21.254799196344155,41.312804594669686,-14.194668548954109,14.498755129284472,-2.3215607331157093,-13.684252957266938,3.384124453820391,1.2245976652533204,22.247157303905624,1.5362559448588853,-2.7200606076996401,-11.935156316414982,20.008420862733058,6.1265973831689191,-7.5525552434317191,-6.5751708514208174,-7.5158179570816275,8.8102344721378163,-13.490382224381902],"y":[-0.5432878844749699,0.042114580071073063,-8.3519850490571379,-0.98418025034340662,3.6913330918807818,-2.4783542040539506,-4.786944637234086,-4.7036006104203176,8.9144943625093678,10.448355002308842,0.26807638979575948,-2.1932986637279073,13.538843496990228,15.686188013429414,-5.1141632807377482,-10.030022080509408,-33.368305813914908,-3.7097664892630142,-6.8385575393374376,16.577728219458226,2.3034224943700918,-13.63688297655043,-1.9059440376288215,4.3932796160892522,-8.2604316012359575,-3.2668311765387252,-0.95034441852525797,-18.542970753072463,-12.939465180796477,-2.8457899168423526,-7.6046052081982616,-1.4485149817603191,-4.2759763733957064,4.8589726425717989,-4.7103968895028272,-1.462878649926153,27.011498808798123,-1.1917966439749714,-5.7887741808971365,-9.409755776262875,-4.4986428490839687,-9.4431276210097295,-3.6451209324188922,-2.2147043972345597,-12.301336891400707,-4.6834319848711443,17.434814035436954,1.7583899843716109,-4.9158843728158068,-3.2680418675072089,62.311332605237737,2.1506984101719273,11.090040269888677,1.8141847412308674,8.0006497805556851,-12.017761604117378,-4.9732773120223621,-16.202109368794773,19.098578482973636,-12.834348410220212,-1.441610816721425,5.3337931684701134,-1.920074799336307,12.562240649367141,-25.964423686827264,13.871775522930422,7.0520155503107507,0.072753948031378121,5.4496374075255982,-10.722142635849531,-10.215739473311102,12.176978792403446,6.4790586165549495,15.705330794121263,-4.7913165668503099,-9.6303104655769278,-1.4933713581027446,6.8163628954617801,4.7599066701822768,-0.83699327659589084,-3.4324259147484089,-6.7753572293967776,14.370634003485964,-6.8361656580046724,-10.191326759138315,2.5064790304745905,-0.83992931801782933,22.240483492444842,5.2680248538128982,10.954202591317166,15.05149465014471,14.614102669886796,1.1484525612388439,-4.9620648364237123,-5.5198321944417623,0.36009804732513928,-4.4601719958040587,8.4952550415913723,-9.4678441387263721,12.825468418515667,-24.898297164229287,-17.167549872110069,-4.2341165504169451,-7.3243472287553359,-9.1924644350624583,24.846622741860109,7.2236194254286055,1.9190714367106543,-9.4316420622275494,-0.56167965108367712,1.1559529597019478],"z":[5.2250313433419819,2.4751086465667536,-2.2452151998527787,-0.98500334447048088,7.6194511034186858,-3.4286753039389111,-1.2294766467434395,-1.6744483530317325,4.2087820726836727,-2.2100768587203286,-2.0260394116830653,-9.7715877647193565,16.772243108918907,5.882200981833285,-6.2870214021648456,3.9970744413816894,4.1779406537361039,6.8116455912341811,5.1718811472576061,5.3181477585083083,1.537726050747797,-19.200605343774868,-4.3961821748421448,-11.261107641249787,-5.1281490915221717,0.99967603435133856,9.0645413924020151,-12.871505310307512,4.9757824225304228,-4.3028237592262109,-4.8967766388741412,-15.900281450994296,4.5484701601627391,-1.9961867704635847,-2.9059678750400573,8.163562359881416,1.9169054005932105,-0.35068255169279355,-6.5902821205924722,-9.3705568818101472,3.8410609739532435,-4.8786149507710936,-0.89798565555397936,1.0373907963289954,3.1461596254654438,6.147445787117829,-3.0403640412270319,1.6289348562633852,-1.7059493718947651,-5.0309512983913027,-28.537614182376132,0.24925296879369949,11.141707814211625,7.0547998083037502,10.645410469464741,-1.6238627409002373,-1.978388235423177,-2.4027717696734103,-3.6099412901288792,6.7100208293732653,0.7697989381502407,2.1177478513393204,-7.0905250530745079,6.6083941806492232,-10.113061831621298,0.6686700612715536,12.491950874855815,3.2833650447130496,5.1798534568847847,-7.2144430122507277,4.6114791931520909,-11.027069332201624,4.3000067139866047,6.2552830913918527,2.4848566879079828,9.6139590385926557,9.221455162585972,-1.2837869352316904,-3.231445557005614,1.0082778852022289,3.9889030466365063,-4.0410167719797041,1.9270759204971919,8.8833865814079012,6.8345700023403788,2.6624970842777365,-2.7165871643589599,1.6007501708935181,0.68467587276240893,7.7205199444696797,1.2005372637617677,-16.19469999621726,2.0254654347316903,-2.1277738534683985,3.0343730477846758,4.6196226088538985,-5.817428458575578,-27.484002178539019,-1.1007391354048386,9.6619939161461605,-4.8696499967004883,-14.443970262219121,4.1170922704274631,5.4002389071207482,-9.4322469732196961,10.212759127743892,8.1377215879474267,6.2658681713260442,9.9954095737077733,-3.6657223968031705,-3.4676489714195684],"mode":"markers","type":"scatter3d","name":"low_cue","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints
```


## epoch: stim, rating



```r
# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
# LINEIV2 = "cue_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p2 = plot_timeseries_onefactor(groupwise_sorted, 
               LINEIV1,MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color="red")
time_points <- seq(1, 0.46 * TR_length, 0.46)
p2 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-12-1.png" width="672" />

```r
p2 + theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-12-2.png" width="672" />



## epoch: 6 cond

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high cue vs low cue
# ------------------------------------------------------------------------------
# --------------------- subset regions based on ROI ----------------------------

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH", "cueL")
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

df_long$sixcond <- factor(
        df_long$condition,
        levels = c("cueH_stimH", "cueL_stimH", 
                   "cueH_stimM", "cueL_stimM",
                   "cueH_stimL", "cueL_stimL")
) 
# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "sixcond"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("sixcond", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "sixcond"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p3H = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("High intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")" ), color=c("red","#5f0f40","gray", "gray", "gray", "gray"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3H + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-13-1.png" width="672" />

```r
p3H + theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-13-2.png" width="672" />


```r
p3M = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("Medium intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")"), color=c("#d6d6d6","#d6d6d6","#bc3908", "#f6aa1c", "gray", "gray"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3M + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-14-1.png" width="672" />

```r
p3M + theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-14-2.png" width="672" />


```r
p3L = plot_timeseries_bar(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle=paste0("Low intensity - Low cue vs. High cue (N = ", unique(groupwise$N), ")"), color=c("gray","gray","gray", "gray", "#2541b2", "#00a6fb"))
```

```
## Warning in geom_errorbar(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown aesthetics: fill
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3L + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-15-1.png" width="672" />

```r
p3L + theme_classic()
```

<img src="50_iv-6cond_dv-firglasserSPM_ttl2_TPJ_files/figure-html/unnamed-chunk-15-2.png" width="672" />








