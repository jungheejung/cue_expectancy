# [fMRI] FIR ~ task {#ch47_fir_glasser}
---
title: "47_iv-cue-stim_dv-firglasserSPM"
output: html_document
date: "2023-08-13"
---


## load tsv
## concatenate 
## per time column, calculate mean and variance
## plot



## parameters {TODO: ignore}

```r
# parameters
main_dir <- dirname(dirname(getwd()))
datadir <- file.path(main_dir, 'analysis/fmri/nilearn/glm/fir')
analysis_folder  = paste0("model47_iv-cue-stim_dv-firglasserSPM")
analysis_dir <-
  file.path(main_dir,
            "analysis",
            "mixedeffect",
            analysis_folder,
            as.character(Sys.Date())) # nolint
dir.create(analysis_dir,
           showWarnings = FALSE,
           recursive = TRUE)
savedir <- analysis_dir
```


## epoch: stim, high stim vs low stim

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high stim vs low stim
# ------------------------------------------------------------------------------
datadir = "/Volumes/spacetop_projects_cue/analysis/fmri/spm/fir/ttl1par"
taskname = "pain"
exclude <- "sub-0001"
filename <- paste0("sub-*_runtype-", taskname, "*roi-MT_tr-42.csv")
  common_path <- Sys.glob(file.path(datadir, "sub-*",  filename
  ))
  filter_path <- common_path[!str_detect(common_path, pattern = exclude)]

df <- do.call("rbind.fill", lapply(filter_path, FUN = function(files) {
    read.table(files, header = TRUE, sep = ",")
    }))
```



```r
parsed_df <- df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)
```

```
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3684 rows [7, 8, 15, 16,
## 23, 24, 31, 32, 39, 40, 47, 48, 55, 56, 63, 64, 71, 72, 79, 80, ...].
```



```r
TR_length <- 42
# --------------------- subset regions based on ROI ----------------------------
df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "stim_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("stim_ordered", "tr_ordered"),
  idvar = "sub"
)
```

```
## 
## Attaching package: 'raincloudplots'
```

```
## The following object is masked _by_ '.GlobalEnv':
## 
##     GeomFlatViolin
```

```r
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "stim_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p1 = plot_timeseries(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High stim vs. Low stim", ggtitle="time_series", color=c("#5f0f40","#ae2012", "#fcbf49"))
```

```
## Warning in geom_ribbon(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown parameters: `width`
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p1 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-4-1.png" width="672" />

```r
p1 + theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-4-2.png" width="672" />







### PCA subjectwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)

# Convert the dataframe to wide format
df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("tr_ordered", "stim_ordered"), 
                       names_from = "sub", 
                       values_from = "mean_per_sub")

df_wide <- pivot_wider(subjectwise, 
                       id_cols = c("sub", "stim_ordered"), 
                       names_from = "tr_ordered", 
                       values_from = "mean_per_sub")
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
meanhighdf_clean <- na.omit(meanhighdf)
high.pca_result <- prcomp(meanhighdf_clean)
high.pca_scores <- as.data.frame(high.pca_result$x)
# Access the proportion of variance explained by each principal component
high.variance_explained <- high.pca_result$sdev^2 / sum(high.pca_result$sdev^2)
plot(high.variance_explained)
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-5-1.png" width="672" />

```r
# Access the standard deviations of each principal component
high.stdev <- high.pca_result$sdev

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
meanlowdf_clean <- na.omit(meanlowdf)
low.pca <- prcomp(meanlowdf_clean)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
```

```
## 
## Attaching package: 'plotly'
```

```
## The following object is masked from 'package:ggplot2':
## 
##     last_plot
```

```
## The following objects are masked from 'package:plyr':
## 
##     arrange, mutate, rename, summarise
```

```
## The following object is masked from 'package:reshape':
## 
##     rename
```

```
## The following object is masked from 'package:stats':
## 
##     filter
```

```
## The following object is masked from 'package:graphics':
## 
##     layout
```

```r
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-20216839624ec9efecf2" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-20216839624ec9efecf2">{"x":{"visdat":{"a2a7560ed59":["function () ","plotlyVisDat"]},"cur_data":"a2a7560ed59","attrs":{"a2a7560ed59":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-20.874717749227173,-31.874376308323832,-1.4505397135044631,-10.304222545745999,-27.546976645786732,-22.530301403398301,-28.81934104709622,19.049063429150319,26.258980915094742,101.07965065035944,7.4049759079835651,9.6305614888774933,28.327720945540829,-13.759103586257108,-15.168017251118314,-68.277488766051462,5.7883538870429208,-62.394420508911082,-21.497619606014098,7.7932845161014246,3.9142078018169539,-40.429752623403637,-19.161206286437487,-45.178750672599627,-25.887614025093438,27.641129946812455,-6.1661019440003173,-19.223755694061044,-1.1859546380269179,11.901082281384552,-186.05573681486405,65.675320864297092,30.97440027807362,-4.4060703500286609,-19.976457739426209,28.345972462754307,-26.026721757040821,-61.541234872150717,10.524684231884798,-40.589250331611751,6.3372803174120467,6.1954807008623236,-94.859141082504379,26.330201587621264,34.965740077171183,-95.601546675745183,-8.9926813065970226,-41.633635103071775,80.735783407734971,29.889856199718512,3.8149079246776347,-5.5731946814341065,3.1708957652874226,-30.018556087366797,50.836816276677091,21.638183499396217,-11.891032739816847,59.50476980536672,-4.0513442382538507,32.987042733731279,209.08684866080139,-52.07983344122011,-23.892810608552704,22.867204861745954,2.0347962241645794,30.059573047656301,-1.484895606426597,47.465945114258567,2.3319708030269846,85.671144673778784,-71.439874695180961,18.497504833436267,10.338875168060314,-4.0870771818692209,50.023234013068802,-28.934951416912696,-11.476068673835472,-26.050010543251624,56.768164141740577,2.1621083520515945,-5.5880518305733977,47.72939330798561,-76.045775985563282,31.262579412101974,55.655209289687846,-15.166770666007698,-24.101243786522176,-22.504394840822624,13.099675175445318,-30.062162250823807,-47.947984728904999,15.446613286957932,-16.161381770346889,-68.695017394575672,22.023878111087903,12.794841559757296,9.5253302295627371,12.188809079800739,152.31523181966705,-11.400108852316524],"y":[-13.777148703955662,-0.62005875915798192,9.4508275426008979,-9.1876237730638941,-12.03659759467161,-19.308669940620781,-3.8099328309442431,-12.038508994122243,-15.431649864862292,-32.588613911039893,21.19504575189481,-38.717736670972414,32.484761890294735,13.726802276060329,3.1349987910475665,19.140328516861246,-11.06120162697583,42.395440830693303,-10.513114240443608,-12.516145947689193,-24.041292768006052,-0.74969671807271743,18.255732576755484,-35.231525726310146,-30.743053433636526,-9.5207257784409496,-7.9702066154666342,21.826269563858009,15.994178226165271,5.8689320782999852,-1.63271228912736,31.827334659809665,-4.2688393847166441,-0.9350420321256655,8.8316645244748706,-26.261386916189021,-17.050012157122019,11.13415293678587,-4.3288214634019209,-2.318246286594086,3.5530282982796213,89.807592133263682,-29.397650735633494,44.456899665749461,-37.090942197103004,1.8063658651999153,-38.763247743873961,-22.758627384070397,68.055090800962589,-14.088292433889093,-17.416810956080546,10.594173994124585,-34.039159549070511,6.07926565415708,1.6812032960192684,28.638821312299811,-4.7752494403632095,45.994883957645875,36.223823530239159,-54.807146165068048,-11.139355616499449,-6.7278231637753967,13.891192799095775,-6.6541599949297288,-20.845328136798884,-53.26866852772487,-2.9719751955894114,5.582887552640134,-14.449969000333002,-25.228533456517628,24.174746613121833,4.9824621407154286,-12.432120353402915,-35.108273830549322,-7.6419723463440876,24.855709331191669,20.421244653061226,32.248499383380761,-9.8073771923747621,4.2817057665853993,4.2473013751412552,-18.276886735884602,21.657986913816071,-14.221510482208535,-0.75741604979543353,-9.9862272343267922,27.23173144627982,24.871868283029173,19.463289865195271,-14.937125796305732,15.907425270905176,-25.273980591361219,-32.629077506866416,1.8707740245232634,19.127390842998256,16.98705157995661,-3.4744322144369155,-1.5206067897109643,46.589349502146689,16.598275231290625],"z":[-10.774189855155512,-14.904003011519789,-3.5051614648074976,-23.561791544913284,-2.6437624824360095,12.277891706557954,-3.3762591254975631,2.1299523034172889,10.351133306241923,-100.66824733220058,-12.04125078324723,3.1510358121076742,8.4393954877121455,24.644391756157709,-23.082831177613663,-6.0264305587879843,6.3007008060762812,-32.726374318447135,14.768476300493516,-11.991923301195206,0.70259993308504565,-23.184886921136261,40.878100276043455,1.6250351937062315,-15.407815250882008,-4.7560314362561407,-14.55892016234151,-17.653191026071269,19.117808237029994,-4.9783939746048915,-3.2106559265212011,2.5257668209469735,-9.4523470347076515,3.0093310875059038,0.93251853868767287,12.838855353751141,37.530478333378781,-3.4186933294997175,1.8443196409077545,-18.994932061610314,-4.8256928892354907,32.840123812357142,30.50970089424176,-28.340082016951172,1.5753305590065658,28.445465489372875,22.694593863783918,-9.5802193968917493,-2.0001496700534585,2.2785363203728686,-20.149761436164599,-6.073404118757896,29.640771744414145,-56.104371441985698,-1.9777249510556643,-3.452802546363452,-5.0718496819829388,2.6979308230676065,23.117118962277665,-1.6644764565692238,38.450083490754032,11.368429314937,8.4276473060549097,19.96484632526484,14.834184755101605,-24.703481086834103,-22.00463419545461,-1.5565725645448778,-44.883952918396858,10.674761524652672,-7.0780634363554134,2.6903760072076861,13.603478936637631,4.3943080531279666,6.3420353623510204,-6.2494167204614879,3.2965350352989895,-0.2597052695851102,24.213009968962613,14.197736247204327,-31.626978314989309,10.555333579973908,-5.30396661920593,12.964296456514013,10.05013531721745,12.318255009995449,-16.555434189943007,19.531412332585035,-3.1262914578488292,-9.6890328422611134,10.275090150522153,6.1392997233171842,25.592067467620875,9.9873731621665325,-9.0831473361074675,10.140586119725894,5.5376897731358143,20.920862984980264,-10.599633334495723,-10.458260796064195],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-73.948047283046961,31.814220676380604,68.190084758773111,-1.3553559450982591,35.525503178389073,20.742778173548988,17.560917199850959,-18.444524503458339,-40.298536571413699,-137.00156749395762,-16.235802597631317,-23.165764746915443,75.088835566015391,17.236388800964271,34.05035300157239,57.061534098953985,-27.390911943059599,48.189949874795801,-12.165309844201813,-16.235642014919076,-7.8861015271256445,37.22165152144207,-35.552910826031763,-5.2098281801580697,12.915459524651943,-71.92396419449814,-3.7382674249153336,12.682980187635916,-22.888035799509527,-32.735513928281627,186.66124802438048,-76.789435412520618,-22.685102714037249,1.8057497153210513,19.330913290064359,-22.49233829124131,23.292955778214779,10.890595600204096,7.4186762934920418,11.523940119409437,8.5847487449332327,41.837923166867839,16.391022102628177,39.491568020787653,-28.39854783643608,61.606288594951494,-1.2543534714595268,22.011870466521575,-22.240992088430776,-85.386559208505531,-3.3804041660893955,-3.4841791061208367,26.216519039668238,-13.395853047838827,-17.09785629043725,59.074951994045975,-10.219313431262959,8.1020826488074302,33.494824213014482,-11.079469972955501,-117.31018224911959,27.054173568084451,3.9631416471920131,4.3785910108453603,29.999103370679222,-41.153818950700426,19.987618299369792,-69.435048970910231,-27.88867854794994,26.653769355225911,59.830347555222211,-10.328151634964145,-4.3004231928189416,-19.041576528438238,4.2211569900571027,13.759718042847426,23.696001845793553,8.5738058272069466,-68.757595548915575,-13.505083022922523,5.0026450721075246,-64.182668088220495,32.243499017815267,-30.167237384358724,-70.54546274799354,-63.669194229208088,33.615746438625258,114.31324190431997,-13.31007273813155,4.4608677906102994,88.678921223316564,-20.323179225784568,8.7880836237653739,42.355706139656682,-26.534733821724469,-20.254122153346298,-4.2261482861564694,-20.48434483188797,-30.504800523078718,2.4103394391609778],"y":[27.515876254513657,2.1736541802356744,-1.5248664345103555,26.790647825465253,11.738586433356604,16.011220699975482,9.1337384630191707,7.1641885484995127,5.3361323469269744,-12.109974073516224,-0.20314049301719175,6.2807085106048879,20.880490815198876,4.4453524658977273,-0.18656844589203703,12.079031882728653,8.9642250172631766,-2.6876419833930045,5.3096946792370927,14.958161641764674,13.655198180374404,25.307595804662352,1.5063443157140792,30.599661253136127,-2.8855691983960843,-0.58216707309093041,13.766478130557678,19.032286939190289,-12.424437597158031,3.1213444331289941,28.012493217059681,-2.3494635508021666,2.8288190208417618,-1.7695138192703435,7.0591999862732777,20.045609947115764,7.2530258796647962,4.7102156604596184,4.9911602238347754,32.339442422286801,-3.66941080597684,-53.659103366922778,-8.40580210797728,-25.645382936814318,2.0664878060430878,-36.468142012600495,16.484946687989019,20.434396394599027,-12.421536127997529,4.7336487724770429,26.346088120613416,17.104043618282297,-14.828883068867398,23.082862356372839,-15.503835622680526,-102.67387044567084,6.7327875828390606,6.0595479124666571,-22.262204722343171,8.7850504061185237,-60.144445458271441,2.346204564140502,-11.41784093096199,13.380785236958312,-11.99391980511133,-7.4570225167683049,-10.292165614508134,-5.8207137432360039,-2.6961039859600588,-30.568023642002601,14.379823393622674,-4.9490758297092459,22.612679862595296,8.307200128873335,-3.0525662150241013,2.5880829105002228,-3.9970255167150173,12.865704017901315,-4.9090744406566982,1.3030200883133483,9.9769028829591395,-13.773192714673886,17.742637086332415,3.656519111620721,-6.8775170876116762,10.126717972351864,-10.702621671491677,-30.183332749155657,-40.146702380497111,3.210873125243062,-20.147159035740543,-1.6638083708776663,19.402431275390729,-10.567635256092659,-22.223095193767648,-21.226531567308257,1.0896362424454531,24.630173366423943,-21.890152326175031,-3.4985961632468925],"z":[3.7577553667908021,8.7867612027153967,0.86618388406457247,-6.5411741179999305,-8.890998379324234,-1.9811606483724451,3.5576412743258805,0.24550897259325052,-10.955001705461116,5.6542200924496537,27.158161183863019,-9.2470165706293415,-16.198935243704419,1.7559549300314248,7.7222724953602428,6.941553017969591,-2.4116470992463452,43.403134730661698,-2.407645949904194,3.0066714293551344,-6.1228868746454159,1.9206510799103993,-3.4579147067752589,-14.346271182191897,-0.3822109056469582,-12.10406793517445,8.751204166016727,-2.1192941333620681,3.4184732632086305,9.1496574547223748,15.329784613873338,-5.3722660526547354,8.1128728181805627,-3.9851481938291302,-0.80463460083321103,-9.6467910444745879,-29.688317908341826,25.543095488718308,-0.15862583079631984,13.56516564958457,-1.5431038877243366,2.1575266778848086,-22.261575317139773,20.435606383173607,-14.553804709377671,-29.44181803487449,-1.4549711677096573,-15.044909480428776,8.7833245490226481,14.107030741109277,3.521239368947247,7.2056001405312102,7.2402278516939305,27.762976255403206,17.765833437029645,16.309746050937111,13.119633835376669,7.1647745092177209,-0.054014960353705163,-19.833921214284366,5.5134934091811196,-1.765149715773602,13.729435994427359,-17.545482436002118,2.8893327882996722,-27.13760347409438,-2.5888377114281997,13.375863424769257,22.012471854561202,-20.685337379655543,15.520770986045019,5.7055570959214874,-12.856114339504021,-13.313397165849471,-9.6414984723547672,18.352357896273432,11.24622858162477,37.352436415536893,-12.629063964109289,8.6787664686473125,6.9816301285269216,-22.038495420968477,44.636268127740792,-6.1507644343197772,7.6155513772063976,10.789450285804492,-39.345627636190216,-33.684405481436933,11.13821774480105,-10.211830464950467,-26.601768179465953,-15.737275485683009,-28.202557127960542,28.879225690861862,18.253945072561713,-2.3594209002373518,-3.9311631619349621,-35.200760330161529,-22.112331275253776,-12.142233844918456],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints
```

### PCA groupwise

```r
# install.packages("ggplot2")    # Install ggplot2 if you haven't already
# install.packages("FactoMineR") # Install FactoMineR if you haven't already
library(ggplot2)
library(FactoMineR)



# Assuming your original dataframe is named 'df'

# Convert the dataframe to wide format
df_wide.group <- pivot_wider(subjectwise,
                       id_cols = c("tr_ordered", "stim_ordered"),
                       names_from = "sub",
                       values_from = "mean_per_sub")
# ------
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# datapoints <- df_ordered$mean_per_sub_norm_mean
# data_df <- data.frame(Dim1 = datapoints, Dim2 = datapoints, Dim3 = datapoints)
# pca <- prcomp(data_df)
# pca_scores <- as.data.frame(pca$x)
# plot_ly(pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# -------
stim_high.df <- df_wide[df_wide$stim_ordered == "stimH",]
stim_low.df <- df_wide[df_wide$stim_ordered == "stimL",]
# selected_columns <- subset(stim_high.df, select = 2:(ncol(stim_high.df) - 1))
meanhighdf <- data.frame(subset(stim_high.df, select = 3:(ncol(stim_high.df) - 1)))
meanhighdf_clean <- na.omit(meanhighdf)
high.pca <- prcomp(meanhighdf_clean)
high.pca_scores <- as.data.frame(high.pca$x)

meanlowdf <- data.frame(subset(stim_low.df, select = 3:(ncol(stim_low.df) - 1)))
meanlowdf_clean <- na.omit(meanlowdf)
low.pca <- prcomp(meanlowdf_clean)
low.pca_scores <- as.data.frame(low.pca$x)
library(plotly)  # You can use plotly to create an interactive 3D plot
# plot_ly(high.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
# plot_ly(low.pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers")
combined_pca_scores <- rbind(high.pca_scores, low.pca_scores)

# Add a new column to indicate the stim_ordered category (high_stim or low_stim)
combined_pca_scores$stim_ordered <- c(rep("high_stim", nrow(high.pca_scores)), rep("low_stim", nrow(low.pca_scores)))

# Create the 3D PCA plot
plot_ly(combined_pca_scores, x = ~PC1, y = ~PC2, z = ~PC3, type = "scatter3d", mode = "markers",
        color = ~stim_ordered)
```

```
## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels

## Warning in RColorBrewer::brewer.pal(N, "Set2"): minimal value for n is 3, returning requested palette with 3 different levels
```

```{=html}
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-237d44b77fe41566a6e8" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-237d44b77fe41566a6e8">{"x":{"visdat":{"a2a77f20b8fa":["function () ","plotlyVisDat"]},"cur_data":"a2a77f20b8fa","attrs":{"a2a77f20b8fa":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-20.874717749227173,-31.874376308323832,-1.4505397135044631,-10.304222545745999,-27.546976645786732,-22.530301403398301,-28.81934104709622,19.049063429150319,26.258980915094742,101.07965065035944,7.4049759079835651,9.6305614888774933,28.327720945540829,-13.759103586257108,-15.168017251118314,-68.277488766051462,5.7883538870429208,-62.394420508911082,-21.497619606014098,7.7932845161014246,3.9142078018169539,-40.429752623403637,-19.161206286437487,-45.178750672599627,-25.887614025093438,27.641129946812455,-6.1661019440003173,-19.223755694061044,-1.1859546380269179,11.901082281384552,-186.05573681486405,65.675320864297092,30.97440027807362,-4.4060703500286609,-19.976457739426209,28.345972462754307,-26.026721757040821,-61.541234872150717,10.524684231884798,-40.589250331611751,6.3372803174120467,6.1954807008623236,-94.859141082504379,26.330201587621264,34.965740077171183,-95.601546675745183,-8.9926813065970226,-41.633635103071775,80.735783407734971,29.889856199718512,3.8149079246776347,-5.5731946814341065,3.1708957652874226,-30.018556087366797,50.836816276677091,21.638183499396217,-11.891032739816847,59.50476980536672,-4.0513442382538507,32.987042733731279,209.08684866080139,-52.07983344122011,-23.892810608552704,22.867204861745954,2.0347962241645794,30.059573047656301,-1.484895606426597,47.465945114258567,2.3319708030269846,85.671144673778784,-71.439874695180961,18.497504833436267,10.338875168060314,-4.0870771818692209,50.023234013068802,-28.934951416912696,-11.476068673835472,-26.050010543251624,56.768164141740577,2.1621083520515945,-5.5880518305733977,47.72939330798561,-76.045775985563282,31.262579412101974,55.655209289687846,-15.166770666007698,-24.101243786522176,-22.504394840822624,13.099675175445318,-30.062162250823807,-47.947984728904999,15.446613286957932,-16.161381770346889,-68.695017394575672,22.023878111087903,12.794841559757296,9.5253302295627371,12.188809079800739,152.31523181966705,-11.400108852316524],"y":[-13.777148703955662,-0.62005875915798192,9.4508275426008979,-9.1876237730638941,-12.03659759467161,-19.308669940620781,-3.8099328309442431,-12.038508994122243,-15.431649864862292,-32.588613911039893,21.19504575189481,-38.717736670972414,32.484761890294735,13.726802276060329,3.1349987910475665,19.140328516861246,-11.06120162697583,42.395440830693303,-10.513114240443608,-12.516145947689193,-24.041292768006052,-0.74969671807271743,18.255732576755484,-35.231525726310146,-30.743053433636526,-9.5207257784409496,-7.9702066154666342,21.826269563858009,15.994178226165271,5.8689320782999852,-1.63271228912736,31.827334659809665,-4.2688393847166441,-0.9350420321256655,8.8316645244748706,-26.261386916189021,-17.050012157122019,11.13415293678587,-4.3288214634019209,-2.318246286594086,3.5530282982796213,89.807592133263682,-29.397650735633494,44.456899665749461,-37.090942197103004,1.8063658651999153,-38.763247743873961,-22.758627384070397,68.055090800962589,-14.088292433889093,-17.416810956080546,10.594173994124585,-34.039159549070511,6.07926565415708,1.6812032960192684,28.638821312299811,-4.7752494403632095,45.994883957645875,36.223823530239159,-54.807146165068048,-11.139355616499449,-6.7278231637753967,13.891192799095775,-6.6541599949297288,-20.845328136798884,-53.26866852772487,-2.9719751955894114,5.582887552640134,-14.449969000333002,-25.228533456517628,24.174746613121833,4.9824621407154286,-12.432120353402915,-35.108273830549322,-7.6419723463440876,24.855709331191669,20.421244653061226,32.248499383380761,-9.8073771923747621,4.2817057665853993,4.2473013751412552,-18.276886735884602,21.657986913816071,-14.221510482208535,-0.75741604979543353,-9.9862272343267922,27.23173144627982,24.871868283029173,19.463289865195271,-14.937125796305732,15.907425270905176,-25.273980591361219,-32.629077506866416,1.8707740245232634,19.127390842998256,16.98705157995661,-3.4744322144369155,-1.5206067897109643,46.589349502146689,16.598275231290625],"z":[-10.774189855155512,-14.904003011519789,-3.5051614648074976,-23.561791544913284,-2.6437624824360095,12.277891706557954,-3.3762591254975631,2.1299523034172889,10.351133306241923,-100.66824733220058,-12.04125078324723,3.1510358121076742,8.4393954877121455,24.644391756157709,-23.082831177613663,-6.0264305587879843,6.3007008060762812,-32.726374318447135,14.768476300493516,-11.991923301195206,0.70259993308504565,-23.184886921136261,40.878100276043455,1.6250351937062315,-15.407815250882008,-4.7560314362561407,-14.55892016234151,-17.653191026071269,19.117808237029994,-4.9783939746048915,-3.2106559265212011,2.5257668209469735,-9.4523470347076515,3.0093310875059038,0.93251853868767287,12.838855353751141,37.530478333378781,-3.4186933294997175,1.8443196409077545,-18.994932061610314,-4.8256928892354907,32.840123812357142,30.50970089424176,-28.340082016951172,1.5753305590065658,28.445465489372875,22.694593863783918,-9.5802193968917493,-2.0001496700534585,2.2785363203728686,-20.149761436164599,-6.073404118757896,29.640771744414145,-56.104371441985698,-1.9777249510556643,-3.452802546363452,-5.0718496819829388,2.6979308230676065,23.117118962277665,-1.6644764565692238,38.450083490754032,11.368429314937,8.4276473060549097,19.96484632526484,14.834184755101605,-24.703481086834103,-22.00463419545461,-1.5565725645448778,-44.883952918396858,10.674761524652672,-7.0780634363554134,2.6903760072076861,13.603478936637631,4.3943080531279666,6.3420353623510204,-6.2494167204614879,3.2965350352989895,-0.2597052695851102,24.213009968962613,14.197736247204327,-31.626978314989309,10.555333579973908,-5.30396661920593,12.964296456514013,10.05013531721745,12.318255009995449,-16.555434189943007,19.531412332585035,-3.1262914578488292,-9.6890328422611134,10.275090150522153,6.1392997233171842,25.592067467620875,9.9873731621665325,-9.0831473361074675,10.140586119725894,5.5376897731358143,20.920862984980264,-10.599633334495723,-10.458260796064195],"mode":"markers","type":"scatter3d","name":"high_stim","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-73.948047283046961,31.814220676380604,68.190084758773111,-1.3553559450982591,35.525503178389073,20.742778173548988,17.560917199850959,-18.444524503458339,-40.298536571413699,-137.00156749395762,-16.235802597631317,-23.165764746915443,75.088835566015391,17.236388800964271,34.05035300157239,57.061534098953985,-27.390911943059599,48.189949874795801,-12.165309844201813,-16.235642014919076,-7.8861015271256445,37.22165152144207,-35.552910826031763,-5.2098281801580697,12.915459524651943,-71.92396419449814,-3.7382674249153336,12.682980187635916,-22.888035799509527,-32.735513928281627,186.66124802438048,-76.789435412520618,-22.685102714037249,1.8057497153210513,19.330913290064359,-22.49233829124131,23.292955778214779,10.890595600204096,7.4186762934920418,11.523940119409437,8.5847487449332327,41.837923166867839,16.391022102628177,39.491568020787653,-28.39854783643608,61.606288594951494,-1.2543534714595268,22.011870466521575,-22.240992088430776,-85.386559208505531,-3.3804041660893955,-3.4841791061208367,26.216519039668238,-13.395853047838827,-17.09785629043725,59.074951994045975,-10.219313431262959,8.1020826488074302,33.494824213014482,-11.079469972955501,-117.31018224911959,27.054173568084451,3.9631416471920131,4.3785910108453603,29.999103370679222,-41.153818950700426,19.987618299369792,-69.435048970910231,-27.88867854794994,26.653769355225911,59.830347555222211,-10.328151634964145,-4.3004231928189416,-19.041576528438238,4.2211569900571027,13.759718042847426,23.696001845793553,8.5738058272069466,-68.757595548915575,-13.505083022922523,5.0026450721075246,-64.182668088220495,32.243499017815267,-30.167237384358724,-70.54546274799354,-63.669194229208088,33.615746438625258,114.31324190431997,-13.31007273813155,4.4608677906102994,88.678921223316564,-20.323179225784568,8.7880836237653739,42.355706139656682,-26.534733821724469,-20.254122153346298,-4.2261482861564694,-20.48434483188797,-30.504800523078718,2.4103394391609778],"y":[27.515876254513657,2.1736541802356744,-1.5248664345103555,26.790647825465253,11.738586433356604,16.011220699975482,9.1337384630191707,7.1641885484995127,5.3361323469269744,-12.109974073516224,-0.20314049301719175,6.2807085106048879,20.880490815198876,4.4453524658977273,-0.18656844589203703,12.079031882728653,8.9642250172631766,-2.6876419833930045,5.3096946792370927,14.958161641764674,13.655198180374404,25.307595804662352,1.5063443157140792,30.599661253136127,-2.8855691983960843,-0.58216707309093041,13.766478130557678,19.032286939190289,-12.424437597158031,3.1213444331289941,28.012493217059681,-2.3494635508021666,2.8288190208417618,-1.7695138192703435,7.0591999862732777,20.045609947115764,7.2530258796647962,4.7102156604596184,4.9911602238347754,32.339442422286801,-3.66941080597684,-53.659103366922778,-8.40580210797728,-25.645382936814318,2.0664878060430878,-36.468142012600495,16.484946687989019,20.434396394599027,-12.421536127997529,4.7336487724770429,26.346088120613416,17.104043618282297,-14.828883068867398,23.082862356372839,-15.503835622680526,-102.67387044567084,6.7327875828390606,6.0595479124666571,-22.262204722343171,8.7850504061185237,-60.144445458271441,2.346204564140502,-11.41784093096199,13.380785236958312,-11.99391980511133,-7.4570225167683049,-10.292165614508134,-5.8207137432360039,-2.6961039859600588,-30.568023642002601,14.379823393622674,-4.9490758297092459,22.612679862595296,8.307200128873335,-3.0525662150241013,2.5880829105002228,-3.9970255167150173,12.865704017901315,-4.9090744406566982,1.3030200883133483,9.9769028829591395,-13.773192714673886,17.742637086332415,3.656519111620721,-6.8775170876116762,10.126717972351864,-10.702621671491677,-30.183332749155657,-40.146702380497111,3.210873125243062,-20.147159035740543,-1.6638083708776663,19.402431275390729,-10.567635256092659,-22.223095193767648,-21.226531567308257,1.0896362424454531,24.630173366423943,-21.890152326175031,-3.4985961632468925],"z":[3.7577553667908021,8.7867612027153967,0.86618388406457247,-6.5411741179999305,-8.890998379324234,-1.9811606483724451,3.5576412743258805,0.24550897259325052,-10.955001705461116,5.6542200924496537,27.158161183863019,-9.2470165706293415,-16.198935243704419,1.7559549300314248,7.7222724953602428,6.941553017969591,-2.4116470992463452,43.403134730661698,-2.407645949904194,3.0066714293551344,-6.1228868746454159,1.9206510799103993,-3.4579147067752589,-14.346271182191897,-0.3822109056469582,-12.10406793517445,8.751204166016727,-2.1192941333620681,3.4184732632086305,9.1496574547223748,15.329784613873338,-5.3722660526547354,8.1128728181805627,-3.9851481938291302,-0.80463460083321103,-9.6467910444745879,-29.688317908341826,25.543095488718308,-0.15862583079631984,13.56516564958457,-1.5431038877243366,2.1575266778848086,-22.261575317139773,20.435606383173607,-14.553804709377671,-29.44181803487449,-1.4549711677096573,-15.044909480428776,8.7833245490226481,14.107030741109277,3.521239368947247,7.2056001405312102,7.2402278516939305,27.762976255403206,17.765833437029645,16.309746050937111,13.119633835376669,7.1647745092177209,-0.054014960353705163,-19.833921214284366,5.5134934091811196,-1.765149715773602,13.729435994427359,-17.545482436002118,2.8893327882996722,-27.13760347409438,-2.5888377114281997,13.375863424769257,22.012471854561202,-20.685337379655543,15.520770986045019,5.7055570959214874,-12.856114339504021,-13.313397165849471,-9.6414984723547672,18.352357896273432,11.24622858162477,37.352436415536893,-12.629063964109289,8.6787664686473125,6.9816301285269216,-22.038495420968477,44.636268127740792,-6.1507644343197772,7.6155513772063976,10.789450285804492,-39.345627636190216,-33.684405481436933,11.13821774480105,-10.211830464950467,-26.601768179465953,-15.737275485683009,-28.202557127960542,28.879225690861862,18.253945072561713,-2.3594209002373518,-3.9311631619349621,-35.200760330161529,-22.112331275253776,-12.142233844918456],"mode":"markers","type":"scatter3d","name":"low_stim","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
```

```r
# data_matrix <- groupwise[groupwise$stim_ordered == "high_stim",c("tr_ordered", "mean_per_sub_norm_mean")]
# sorted_indices <- order(data_matrix$tr_ordered)
# df_ordered <- data_matrix[sorted_indices, ]
# pca_result <- PCA(data_matrix$mean_per_sub_norm_mean)
# datapoints <- df$datapoints

# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
# combined_pca <- combined_pca_scores %>%
  # mutate(group_index = group_indices(., stim_ordered))

combined_pca <- combined_pca_scores %>%
  group_by(stim_ordered) %>%
  mutate(group_index = row_number())
ggplot(combined_pca, aes(x=group_index,y=PC2, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-6-2.png" width="672" />

### lmer per region

```r
# model.time <- lmer(tr_value ~ tr_ordered * stim_ordered  + (1 | roi/sub), data = df_long)
# 
# # model.time <- lmer(tr_value ~ tr_ordered * cue_ordered + (cue_ordered|sub), data=dfcue_long)
# summary(model.time)
# Assuming your data frame is named 'data_df' and 'value' is the column containing the values extracted from the regions.

# Load necessary packages
library(lme4)             # Load the lme4 package

# Create an empty vector to store corrected p-values for each region
corrected_p_values <- numeric()

anova_results_list <- list()
# Loop through each region
for (region in unique(df_long$roi)) {
  # Subset the data for the current region
  region_data <- subset(df_long, region == region)
  
  # Fit the mixed-effects model with region and subject as random effects
  model.time <- lmer(tr_value ~ tr_ordered * stim_ordered  + (1 | sub), data = region_data)
  aov.model.time <- anova(model.time)
  # Extract p-values for cue and time effects
  # p_values <- coef(summary(model))[, "Pr(>|t|)"][c("cuetype1", "time")]
  p_values <- aov.model.time$"Pr(>F)"
  labels <- rownames(aov.model.time)
  anova_results <- data.frame(Term = labels, P_Value = p_values)
  anova_results_list[[length(anova_results_list) + 1]] <- anova_results
  
  # Correct p-values for multiple comparisons (using Bonferroni method)
  corrected_p_values <- c(corrected_p_values, p.adjust(p_values, method = "bonferroni"))
}
```

```
## Warning: Unknown or uninitialised column: `roi`.
```

```r
combined_anova_results <- do.call(rbind, anova_results_list)

# Now you have the corrected p-values for each region, indicating significant cue or time effects.
# You can use these p-values to identify regions with significant effects based on a chosen significance level (e.g., 0.05).
```


```r
# Assuming you have a dataframe named 'data' containing the 20 data points, 'x' and 'y' values, and corresponding standard deviations 'sd'

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)

# Create the plot
# y = "mean_per_sub_mean"z
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean, group = stim_ordered, colour=stim_ordered)) +
  stat_smooth(method="loess", span=0.25, se=TRUE, aes(color=stim_ordered), alpha=0.3) +
  theme_bw()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-8-1.png" width="672" />

```r
# ggplot(data=groupwise, aes(x=tr_ordered, y=mean_per_sub_mean, ymin=se, ymax=se, fill=stim_ordered, linetype=stim_ordered)) + 
#  geom_line() + 
#  geom_ribbon(alpha=0.5)  
# Assuming you have a dataframe named 'data' containing the 20 mean data points and corresponding standard errors
# 'x' represents the x-values (e.g., time points)
# 'mean_y' represents the mean y-values
# 'se_y' represents the standard errors of the mean y-values

# Load the ggplot2 library
# install.packages("ggplot2")
library(ggplot2)
# groupwise$x <- as.numeric(groupwise$x)
# 
# # Sort the dataframe by the 'x' variable (if it's not already sorted)
# data <- data[order(data$x), ]

# Create the plot
# Create the plot with custom span and smoothing method
ggplot(groupwise, aes(x=tr_ordered,y=mean_per_sub_mean)) +
  geom_line() +                                   # Plot the smooth line for the mean
  geom_ribbon(aes(ymin = mean_per_sub_mean - se, ymax = mean_per_sub_mean + se), alpha = 0.3) + # Add the ribbon for standard error
  geom_smooth(method = "loess", span = 0.1, se = FALSE) +       # Add the loess smoothing curve
  labs(x = "X-axis Label", y = "Y-axis Label", title = "Smooth Line with Standard Error Ribbon") +
  theme_minimal()
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-9-1.png" width="672" />



## epoch: stim, high cue vs low cue

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high cue vs low cue
# ------------------------------------------------------------------------------
# --------------------- subset regions based on ROI ----------------------------

# datadir = "/Volumes/spacetop_projects_cue/analysis/fmri/spm/fir/ttl1"
# taskname = "pain"
# exclude <- "sub-0001"
# filename <- paste0("sub-*_runtype-", taskname, "*roi-MT_tr-42.csv")
#   common_path <- Sys.glob(file.path(datadir, "sub-*",  filename
#   ))
#   filter_path <- common_path[!str_detect(common_path, pattern = exclude)]
# 
# df <- do.call("rbind.fill", lapply(filter_path, FUN = function(files) {
#     read.table(files, header = TRUE, sep = ",")
#     }))


parsed_df <- df %>%
  separate(condition, into = c("cue", "stim"), sep = "_", remove = FALSE)
```

```
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3684 rows [7, 8, 15, 16,
## 23, 24, 31, 32, 39, 40, 47, 48, 55, 56, 63, 64, 71, 72, 79, 80, ...].
```

```r
TR_length <- 42

df_long <- pivot_longer(parsed_df, cols = starts_with("tr"), names_to = "tr_num", values_to = "tr_value")

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH", "cueL")
    )

# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "cue_ordered"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("cue_ordered", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "cue_ordered"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p2 = plot_timeseries(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("red","blue"))
```

```
## Warning in geom_ribbon(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown parameters: `width`
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p2 + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-10-1.png" width="672" />

```r
p2 + theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-10-2.png" width="672" />



## epoch: 6 cond

```r
# ------------------------------------------------------------------------------
#                       epoch stim, high cue vs low cue
# ------------------------------------------------------------------------------
# --------------------- subset regions based on ROI ----------------------------

# ----------------------------- clean factor -----------------------------------
df_long$tr_ordered <- factor(
        df_long$tr_num,
        levels = c(paste0("tr", 1:TR_length))
    )
df_long$cue_ordered <- factor(
        df_long$cue,
        levels = c("cueH", "cueL")
    )
df_long$stim_ordered <- factor(
        df_long$stim,
        levels = c("stimH", "stimM", "stimL")
    )

df_long$sixcond <- factor(
        df_long$condition,
        levels = c("cueH_stimH", "cueL_stimH", 
                   "cueH_stimM", "cueL_stimM",
                   "cueH_stimL", "cueL_stimL")
) 
# --------------------------- summary statistics -------------------------------
subjectwise <- meanSummary(df_long,
                                      c("sub", "tr_ordered", "sixcond"), "tr_value")
groupwise <- summarySEwithin(
  data = subjectwise,
  measurevar = "mean_per_sub",
  withinvars = c("sixcond", "tr_ordered"),
  idvar = "sub"
)
groupwise$task <- taskname
# https://stackoverflow.com/questions/29402528/append-data-frames-together-in-a-for-loop/29419402

# --------------------------------- plot ---------------------------------------
LINEIV1 = "tr_ordered"
LINEIV2 = "sixcond"
MEAN = "mean_per_sub_norm_mean"
ERROR = "se"
dv_keyword = "actual"
sorted_indices <- order(groupwise$tr_ordered)
groupwise_sorted <- groupwise[sorted_indices, ]
p3H = plot_timeseries(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("#5f0f40","red","gray", "gray", "gray", "gray"))
```

```
## Warning in geom_ribbon(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown parameters: `width`
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3H + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-11-1.png" width="672" />

```r
p3H + theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-11-2.png" width="672" />


```r
p3M = plot_timeseries(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("#d6d6d6","#d6d6d6","#bc3908", "#f6aa1c", "gray", "gray"))
```

```
## Warning in geom_ribbon(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown parameters: `width`
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3M + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-12-1.png" width="672" />

```r
p3M + theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-12-2.png" width="672" />


```r
p3L = plot_timeseries(groupwise, 
               LINEIV1, LINEIV2, MEAN, ERROR,  xlab = "Runs" , ylab= "Epoch: stimulus, High cue vs. Low cue", ggtitle="time_series", color=c("gray","gray","gray", "gray", "#2541b2", "#00a6fb"))
```

```
## Warning in geom_ribbon(aes(ymin = (.data[[mean]] - .data[[error]]), ymax =
## (.data[[mean]] + : Ignoring unknown parameters: `width`
```

```r
time_points <- seq(1, 0.46 * TR_length, 0.46)
p3L + scale_x_discrete(labels = setNames(time_points, colnames(df_long)[7:7+TR_length]))+ theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-13-1.png" width="672" />

```r
p3L + theme_classic()
```

<img src="47_iv-cue-stim_dv-firglasserSPM_files/figure-html/unnamed-chunk-13-2.png" width="672" />



